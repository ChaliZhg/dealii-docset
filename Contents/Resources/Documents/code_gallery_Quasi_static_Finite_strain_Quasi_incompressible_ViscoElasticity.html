<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The &#39;Quasi-Static Finite-Strain Quasi-incompressible Visco-elasticity&#39; code gallery program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2017 by the deal.II authors"></meta>
<meta name="deal.II-version" content="9.0.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 9.0.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">The 'Quasi-Static Finite-Strain Quasi-incompressible Visco-elasticity' code gallery program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p> 
<p align="center"> 
  This program was contributed by Jean-Paul Pelteret &lt;jppelteret@gmail.com&gt;.
  <br>
  It comes without any warranty or support by its authors or the authors of deal.II.
</p>

</p>
<p>This program is part of the <a class="el" href="CodeGallery.html">deal.II code gallery</a> and consists of the following files (click to inspect):</p><ul>
<li><a href="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/README.md">README.md</a> (<a href="#ann-README.md">annotated version</a>)</li>
<li><a href="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/CMakeLists.txt">CMakeLists.txt</a></li>
<li><a href="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/animation-solution_p.gif">doc/animation-solution_p.gif</a></li>
<li><a href="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/animation-solution_u.gif">doc/animation-solution_u.gif</a></li>
<li><a href="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/entry-name">doc/entry-name</a></li>
<li><a href="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/geometry.png">doc/geometry.png</a></li>
<li><a href="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/grid_2d-final_mirrored.png">doc/grid_2d-final_mirrored.png</a></li>
<li><a href="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/grid_2d-mirrored.png">doc/grid_2d-mirrored.png</a></li>
<li><a href="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/grid_3d-partitioning.png">doc/grid_3d-partitioning.png</a></li>
<li><a href="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/results-vertex_displacement.png">doc/results-vertex_displacement.png</a></li>
<li><a href="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/parameters.prm">parameters.prm</a></li>
<li><a href="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/viscoelastic_strip_with_hole.cc">viscoelastic_strip_with_hole.cc</a> (<a href="#ann-viscoelastic_strip_with_hole.cc">annotated version</a>)</li>
</ul>
<h1>Pictures from this code gallery program</h1>
<table class="doxtable">
<tr>
<td><div class="image">
<img src="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/results-vertex_displacement.png" width="250"/>
</div>
  </td><td><div class="image">
<img src="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/grid_3d-partitioning.png" width="250"/>
</div>
  </td><td><div class="image">
<img src="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/grid_2d-mirrored.png" width="250"/>
</div>
  </td><td><div class="image">
<img src="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/grid_2d-final_mirrored.png" width="250"/>
</div>
   </td></tr>
<tr>
<td><div class="image">
<img src="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/geometry.png" width="250"/>
</div>
  </td><td><div class="image">
<img src="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/animation-solution_u.gif" width="250"/>
</div>
  </td><td><div class="image">
<img src="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/animation-solution_p.gif" width="250"/>
</div>
   </td></tr>
</table>
<p><a class="anchor" id="ann-README.md"></a> </p><h1>Annotated version of README.md</h1>
<h2>Overview</h2>
<p>Many rubber-like materials are not only near-incompressible in nature, but also exhibit a viscoelastic response (within the tested load and time scales). In this example, we extend the near-incompressible rate-independent constitutive used in <a class="el" href="step_44.html">step-44</a> (which implements three-field quasi-static quasi-incompressible finite elasticity) to one that displays rate-dependent behavior. It may seem that there is a contradiction of terms here, so lets clarify by saying the the problem remains "quasi-static" in the sense that inertial terms remain insignificant, even though the material response itself is rate-dependent. This implies that, for these fictitious material parameters, it is assumed that the timescale for material relaxation is much longer than that of elastic wave propagation.</p>
<p>We've also taken the opportunity to extend the code first shown in <a class="el" href="step_44.html">step-44</a> to parallel (the primary reason for this contribution), using <code>Metis</code> as a grid partitioner and <code>Trilinos</code> for linear algebra. As a motivation as to why one might still choose to use <code>Metis</code> (also associated with <a class="el" href="classparallel_1_1shared_1_1Triangulation.html">parallel::shared::Triangulation</a> in <a class="el" href="step_18.html">step-18</a>, although this triangulation is not used in this instance) over <code>p4est</code> (also associated with <a class="el" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation</a>) as a grid partitioner, at this point in time it is not possible to use the <code>hp</code> finite-element in conjunction with the distributed grid, meaning that this code could not, for example, be readily extended to the application shown in</p>
<p>J-P. V. Pelteret, D. Davydov, A. McBride, D. Vu, P. Steinmann, Computational electro-elasticity and magneto-elasticity for quasi-incompressible media immersed in free space. International Journal for Numerical Methods in Engineering, 2016, 108, 1307-1342. DOI: <a href="http://doi.org/10.1002/nme.5254">10.1002/nme.5254</a></p>
<p>The discerning reader will observe that we've chosen to employ <code>deal.II</code>'s built in solvers as opposed to using <code>Trilinos</code> solvers. This is because the system matrices <code>K_Jp</code> and <code>K_pJ</code>, although block diagonal and well conditioned, and for some reason (perhaps pertaining to the negative definite nature of these blocks, or that the entries are very small in magnitude) <code>Trilinos</code> solvers are not sufficiently robust to compute inverse matrix-vector multiplication with. We do stress, however, that to date <b>no great attempt has been made by the author to overcome this issue</b> other than by making an entirely different choice of solver.</p>
<h3>Finite deformation of a thin strip with a hole.</h3>
<p>Various permutations of the problem of an elastomeric strip with a centered cut-out can be found in the literature for solid mechanics, in particular (but not limited to) that pertaining to</p>
<p>incompressible elasticity elasto-plasticity electro-elasticity thermo-elasticity.</p>
<p>Here we implement another permutation (one that is not necessarily benchmarked elsewhere), simply for demonstration purposes. The basic problem configuration is summarized in the following image.</p>
<div class="image">
<img src="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/geometry.png" alt="Problem geometry"/>
</div>
<p>A thin strip of material with a circular hole is (in <code>3d</code>) constrained in the <code>Z</code> direction and loaded in the direction of its long edge. In our implementation, this load is applied to the <code>+Y</code> surface and may either be displacement control (a <code>Dirichlet</code> condition) or a traction load (a <code>Neumann</code> boundary condition). Due to the symmetry of both the geometry and load, the problem can be simplified by modeling only an eighth of the geometry in <code>3d</code> or a quarter in <code>2d</code>. By doing so, it it necessary to then implement symmetry conditions on the surfaces coincident with the <code>X-Z</code> and <code>Y-Z</code> planes (and the <code>X-Y</code> plane in <code>3d</code>). The <code>+X</code> surface, and that of the hole itself, remain traction-free.</p>
<p>In three dimensions, the geometry (and a potential partitioning over 8 processors) looks as follows:</p>
<div class="image">
<img src="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/grid_3d-partitioning.png" alt="3d grid with partitioning"/>
</div>
<p>Note that, for this particular formulation, the two-dimensional case corresponds to neither plane-strain nor plane-stress conditions.</p>
<h2>Requirements</h2>
<p>Version <code>8.5.0</code> or greater of <code>deal.II</code> <code>C++11</code> and <code>MPI</code> must be enabled The following packages must also be enabled: <code>Metis</code> <code>Trilinos</code></p>
<h2>Compiling and running</h2>
<p>Similar to the example programs, run </p><div class="fragment"><div class="line">cmake -DDEAL_II_DIR=/path/to/deal.II .</div></div><!-- fragment --><p> in this directory to configure the problem. You can switch between debug and release mode by calling either </p><div class="fragment"><div class="line">make debug</div></div><!-- fragment --><p> or </p><div class="fragment"><div class="line">make release</div></div><!-- fragment --><p> The problem may then be run in serial mode with </p><div class="fragment"><div class="line">make run</div></div><!-- fragment --><p> and in parallel (in this case, on <code>4</code> processors) with </p><div class="fragment"><div class="line">mpirun -np 4 ./viscoelastic_strip_with_hole</div></div><!-- fragment --><p>This program can be run in <code>2d</code> or <code>3d</code>; this choice can be made by making the appropriate changes in the <code>main()</code> function.</p>
<h2>Reference for this work</h2>
<p>If you use this program as a basis for your own work, please consider citing it in your list of references. The initial version of this work was contributed to the deal.II project by the authors listed in the following citation: J-P. V. Pelteret, The deal.II code gallery: Quasi-static Finite-Strain Quasi-incompressible Visco-elasticity, 2017. DOI: <a href="http://doi.org/10.5281/zenodo.437604">10.5281/zenodo.437604</a> </p><div class="image">
<object type="image/svg+xml" data="https://zenodo.org/badge/DOI/10.5281/zenodo.437604.svg" style="float: right;"></object>
</div>
<h3>Acknowledgements</h3>
<p>The support of this work by the European Research Council (ERC) through the Advanced Grant 289049 MOCOPOLY is gratefully acknowledged by the author.</p>
<h2>Recommended Literature</h2>
<p>C. Miehe (1994), Aspects of the formulation and finite element implementation of large strain isotropic elasticity. International Journal for Numerical Methods in Engineering 37 , 12, 1981-2004. DOI: <a href="http://doi.org/10.1002/nme.1620371202">10.1002/nme.1620371202</a>; G.A. Holzapfel (2001), Nonlinear Solid Mechanics. A Continuum Approach for Engineering, John Wiley &amp; Sons. ISBN: <a href="http://eu.wiley.com/WileyCDA/WileyTitle/productCd-0471823198.html">978-0-471-82319-3</a>; P. Wriggers (2008), Nonlinear finite element methods, Springer. DOI: <a href="http://doi.org/10.1007/978-3-540-71001-1">10.1007/978-3-540-71001-1</a>; T.J.R. Hughes (2000), The Finite Element Method: Linear Static and Dynamic Finite Element Analysis, Dover. ISBN: <a href="http://store.doverpublications.com/0486411818.html">978-0486411811</a></p>
<p>The derivation of the finite-element problem, namely the definition and linearization of the residual and their subsequent discretization are quite lengthy and involved. However, this is already detailed in <a class="el" href="step_44.html">step-44</a>, some of the aforementioned literature, as well as J-P. V. Pelteret, A computational neuromuscular model of the human upper airway with application to the study of obstructive sleep apnoea. PhD Thesis, University of Cape Town, 2013. <a href="http://hdl.handle.net/11427/9519">http://hdl.handle.net/11427/9519</a></p>
<p>and need not be repeated here. As for the viscoelastic constitutive law (which satisfies the dissipation inequality through the definition of an internal variable that we denote as <code>Q</code> in the code), this is derived and presented in detail in C. Linder, M. Tkachuk &amp; C. Miehe, A micromechanically motivated diffusion-based transient network model and its incorporation into finite rubber viscoelasticity. Journal of the Mechanics and <a class="el" href="namespacePhysics.html">Physics</a> of Solids, 2011, 59, 2134-2156. DOI: <a href="http://doi.org/10.1016/j.jmps.2011.05.005">10.1016/j.jmps.2011.05.005</a></p>
<p>In particular, the relevant equations from Linder et al.'s work that are implemented in this work are equations 47, 54 and 56. Note that the time discretization for the rate-dependent internal variable for this single dissipative mechanism is only first-order accurate.</p>
<h2>Results</h2>
<p>To begin, here is a comparison of the initial grid for the <code>2d</code> version of the problem (mirrored about the x-axis and rotated <code>90</code> degrees anti-clockwise)</p>
<div class="image">
<img src="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/grid_2d-mirrored.png" alt="Initial grid"/>
</div>
<p>and of the final, displaced grid after the load has been applied and the material is in a (near-completely) relaxed state.</p>
<div class="image">
<img src="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/grid_2d-final_mirrored.png" alt="Displaced grid"/>
</div>
<p>These results, as well as those that follow, were produced using the following material properties: The Poisson ratio is <code>0.4995</code> The elastic shear modulus is <code>80MPa</code> The viscoelastic shear modulus is <code>160MPa</code> The viscoelastic relaxation time is <code>2.5s</code></p>
<p>while the boundary conditions were configured in the following manner: The "driving" boundary condition on the short-side (<code>+Y</code> face) is of the <code>Neumann</code> variety The applied hydrostatic pressure is <code>-150Pa</code> (i.e. a tensile load) The load ramp time is <code>1s</code></p>
<p>The following chart highlights the displacement of several vertices and clearly illustrates the viscoelastic nature of the material.</p>
<div class="image">
<img src="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/results-vertex_displacement.png" alt="Problem geometry"/>
</div>
<p>During the initial phase, the load is applied over a period of time much shorter than the material's characteristic relaxation time. The material therefore exhibits a very stiff response, and relaxes as the load remains constant for the remainder of the simulation. This deformation that occurs under constant load is commonly known as creep.</p>
<p>We've been lazy and stopped the simulation slightly prematurely, but it is clear that the material's displacement is moving asymptotically towards a equilibrium solution. You can also check what the true resting load state is by removing the dissipative mechanism (setting its shear modulus to zero) and rerunning the simulation with the material then exhibiting rate-independent behavior. Note that in this case, the number of time step over which the load is applied must likely be increased in order to ensure stability of the nonlinear problem.</p>
<h3>Animations</h3>
<p>Just in case you found the presented chart a little dry and undigestible, below are a couple of animations that demonstrate the viscoelastic nature of the material in a more visually appealing manner.</p>
<p>Animation of the evolution of the displacement field** </p><div class="image">
<img src="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/animation-solution_u.gif" alt="Displacement field"/>
</div>
<p>Animation of the evolution of the pressure field** </p><div class="image">
<img src="../code-gallery/Quasi_static_Finite_strain_Quasi_incompressible_ViscoElasticity/doc/animation-solution_p.gif" alt="Pressure field"/>
</div>
<p><a class="anchor" id="ann-viscoelastic_strip_with_hole.cc"></a> </p><h1>Annotated version of viscoelastic_strip_with_hole.cc</h1>
<div class="fragment"><div class="line">/ * ---------------------------------------------------------------------</div><div class="line"> * Copyright (C) 2017 by the deal.II authors and</div><div class="line"> *                           Jean-Paul Pelteret</div><div class="line"> *</div><div class="line"> * This file is part of the deal.II library.</div><div class="line"> *</div><div class="line"> * The deal.II library is free software; you can use it, redistribute</div><div class="line"> * it, and/or modify it under the terms of the GNU Lesser General</div><div class="line"> * Public License as published by the Free Software Foundation; either</div><div class="line"> * version 2.1 of the License, or (at your option) any later version.</div><div class="line"> * The full text of the license can be found in the file LICENSE at</div><div class="line"> * the top level of the deal.II distribution.</div><div class="line"> *</div><div class="line"> * ---------------------------------------------------------------------</div><div class="line"> * /</div><div class="line"></div><div class="line">/ *</div><div class="line"> * Authors: Jean-Paul Pelteret, University of Erlangen-Nuremberg, 2017</div><div class="line"> * /</div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;deal.II/base/mpi.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/base/function.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/base/parameter_handler.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/base/point.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/base/quadrature_lib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/base/symmetric_tensor.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/base/tensor.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/base/timer.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/base/work_stream.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/dofs/dof_renumbering.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/dofs/dof_tools.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/base/quadrature_point_data.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/grid/filtered_iterator.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/grid/grid_generator.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/grid/grid_tools.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/grid/grid_in.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/grid/manifold_lib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/grid/tria.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/grid/tria_boundary_lib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/fe/fe_dgp_monomial.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/fe/fe_q.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/fe/fe_system.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/fe/fe_tools.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/fe/fe_values.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/fe/mapping_q_eulerian.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/lac/block_sparsity_pattern.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/lac/dynamic_sparsity_pattern.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/lac/full_matrix.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/lac/constraint_matrix.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/lac/solver_selector.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/lac/trilinos_block_sparse_matrix.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/lac/trilinos_block_vector.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/lac/trilinos_precondition.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/lac/trilinos_sparsity_pattern.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/lac/trilinos_sparse_matrix.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/lac/trilinos_vector.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/lac/linear_operator.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/lac/packaged_operation.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/lac/trilinos_linear_operator.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/numerics/data_out.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/numerics/vector_tools.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/physics/transformations.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/physics/elasticity/kinematics.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;deal.II/physics/elasticity/standard_tensors.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;numeric&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;deal.II/grid/grid_out.h&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>ViscoElasStripHole</div><div class="line">{</div><div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div><div class="line">  <span class="keyword">namespace </span>LA = <a class="code" href="namespaceTrilinosWrappers.html">TrilinosWrappers</a>;</div><div class="line">  <span class="keyword">namespace </span>Parameters</div><div class="line">  {</div><div class="line">    <span class="keyword">struct </span>BoundaryConditions</div><div class="line">    {</div><div class="line">      BoundaryConditions();</div><div class="line"></div><div class="line">      std::string driver;</div><div class="line">      <span class="keywordtype">double</span> stretch;</div><div class="line">      <span class="keywordtype">double</span> pressure;</div><div class="line">      <span class="keywordtype">double</span> load_time;</div><div class="line"></div><div class="line">      <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a685c06c8ba84120df596d9e56f5510e2">types::boundary_id</a> boundary_id_minus_X;</div><div class="line">      <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a685c06c8ba84120df596d9e56f5510e2">types::boundary_id</a> boundary_id_plus_X;</div><div class="line">      <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a685c06c8ba84120df596d9e56f5510e2">types::boundary_id</a> boundary_id_minus_Y;</div><div class="line">      <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a685c06c8ba84120df596d9e56f5510e2">types::boundary_id</a> boundary_id_plus_Y;</div><div class="line">      <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a685c06c8ba84120df596d9e56f5510e2">types::boundary_id</a> boundary_id_minus_Z;</div><div class="line">      <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a685c06c8ba84120df596d9e56f5510e2">types::boundary_id</a> boundary_id_plus_Z;</div><div class="line">      <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a685c06c8ba84120df596d9e56f5510e2">types::boundary_id</a> boundary_id_hole;</div><div class="line">      <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a9f062a82e4dab1dd631a2c4fa8162bea">types::manifold_id</a> manifold_id_hole;</div><div class="line"></div><div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line">      declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">      <span class="keywordtype">void</span></div><div class="line">      parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">    };</div><div class="line">    BoundaryConditions::BoundaryConditions()</div><div class="line">      :</div><div class="line">      driver (<span class="stringliteral">&quot;Neumann&quot;</span>),</div><div class="line">      stretch (2.0),</div><div class="line">      pressure(0.0),</div><div class="line">      load_time(2.5),</div><div class="line">      boundary_id_minus_X (1),</div><div class="line">      boundary_id_plus_X (2),</div><div class="line">      boundary_id_minus_Y (3),</div><div class="line">      boundary_id_plus_Y (4),</div><div class="line">      boundary_id_minus_Z (5),</div><div class="line">      boundary_id_plus_Z (6),</div><div class="line">      boundary_id_hole (10),</div><div class="line">      manifold_id_hole (10)</div><div class="line">    { }</div><div class="line">    <span class="keywordtype">void</span> BoundaryConditions::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Boundary conditions&quot;</span>);</div><div class="line">      {</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Driver&quot;</span>, <span class="stringliteral">&quot;Dirichlet&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;Dirichlet|Neumann&quot;</span>),</div><div class="line">                          <span class="stringliteral">&quot;Driver boundary condition for the problem&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Final stretch&quot;</span>, <span class="stringliteral">&quot;2.0&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(1.0),</div><div class="line">                          <span class="stringliteral">&quot;Positive stretch applied length-ways to the strip&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Applied pressure&quot;</span>, <span class="stringliteral">&quot;0.0&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(-1e3,1e3),</div><div class="line">                          <span class="stringliteral">&quot;Hydrostatic pressure applied (in the referential configuration) to the interior surface of the hole&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Load time&quot;</span>, <span class="stringliteral">&quot;2.5&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div><div class="line">                          <span class="stringliteral">&quot;Total time over which the stretch/pressure is ramped up&quot;</span>);</div><div class="line">      }</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div><div class="line">    }</div><div class="line">    <span class="keywordtype">void</span> BoundaryConditions::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Boundary conditions&quot;</span>);</div><div class="line">      {</div><div class="line">        driver = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Driver&quot;</span>);</div><div class="line">        stretch = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Final stretch&quot;</span>);</div><div class="line">        pressure = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Applied pressure&quot;</span>);</div><div class="line">        load_time = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Load time&quot;</span>);</div><div class="line">      }</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div><div class="line">    }</div><div class="line">    <span class="keyword">struct </span><a class="code" href="classFESystem.html">FESystem</a></div><div class="line">    {</div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> poly_degree;</div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> quad_order;</div><div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line">      declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">      <span class="keywordtype">void</span></div><div class="line">      parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">    };</div><div class="line">    <span class="keywordtype">void</span> FESystem::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Finite element system&quot;</span>);</div><div class="line">      {</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Polynomial degree&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div><div class="line">                          <span class="stringliteral">&quot;Displacement system polynomial order&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Quadrature order&quot;</span>, <span class="stringliteral">&quot;3&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div><div class="line">                          <span class="stringliteral">&quot;Gauss quadrature order&quot;</span>);</div><div class="line">      }</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div><div class="line">    }</div><div class="line">    <span class="keywordtype">void</span> FESystem::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Finite element system&quot;</span>);</div><div class="line">      {</div><div class="line">        poly_degree = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Polynomial degree&quot;</span>);</div><div class="line">        quad_order = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Quadrature order&quot;</span>);</div><div class="line">      }</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div><div class="line">    }</div><div class="line">    <span class="keyword">struct </span>Geometry</div><div class="line">    {</div><div class="line">      <span class="keywordtype">double</span> <a class="code" href="classOpenCASCADE_1_1ArclengthProjectionLineManifold.html#acd38eecd3e2a8b201caac7c7a6a7da83">length</a>;</div><div class="line">      <span class="keywordtype">double</span> width;</div><div class="line">      <span class="keywordtype">double</span> thickness;</div><div class="line">      <span class="keywordtype">double</span> hole_diameter;</div><div class="line">      <span class="keywordtype">double</span> hole_division_fraction;</div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_repetitions_xy;</div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_repetitions_z;</div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> global_refinement;</div><div class="line">      <span class="keywordtype">double</span>       <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">scale</a>;</div><div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line">      declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">      <span class="keywordtype">void</span></div><div class="line">      parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">    };</div><div class="line">    <span class="keywordtype">void</span> Geometry::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Geometry&quot;</span>);</div><div class="line">      {</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Length&quot;</span>, <span class="stringliteral">&quot;100.0&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div><div class="line">                          <span class="stringliteral">&quot;Total sample length&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Width&quot;</span>, <span class="stringliteral">&quot;50.0&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div><div class="line">                          <span class="stringliteral">&quot;Total sample width&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Thickness&quot;</span>, <span class="stringliteral">&quot;5.0&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div><div class="line">                          <span class="stringliteral">&quot;Total sample thickness&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Hole diameter&quot;</span>, <span class="stringliteral">&quot;20.0&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div><div class="line">                          <span class="stringliteral">&quot;Hole diameter&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Hole division fraction&quot;</span>, <span class="stringliteral">&quot;0.5&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0,1.0),</div><div class="line">                          <span class="stringliteral">&quot;A geometric factor affecting the discretisation near the hole&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Number of subdivisions in cross-section&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1.0),</div><div class="line">                          <span class="stringliteral">&quot;A factor defining the number of initial grid subdivisions in the cross-section&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Number of subdivisions thickness&quot;</span>, <span class="stringliteral">&quot;6&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1.0),</div><div class="line">                          <span class="stringliteral">&quot;A factor defining the number of initial grid subdivisions through the thickness&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Global refinement&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div><div class="line">                          <span class="stringliteral">&quot;Global refinement level&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Grid scale&quot;</span>, <span class="stringliteral">&quot;1e-3&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div><div class="line">                          <span class="stringliteral">&quot;Global grid scaling factor&quot;</span>);</div><div class="line">      }</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div><div class="line">    }</div><div class="line">    <span class="keywordtype">void</span> Geometry::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Geometry&quot;</span>);</div><div class="line">      {</div><div class="line">        <a class="code" href="classOpenCASCADE_1_1ArclengthProjectionLineManifold.html#acd38eecd3e2a8b201caac7c7a6a7da83">length</a> = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Length&quot;</span>);</div><div class="line">        width = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Width&quot;</span>);</div><div class="line">        thickness = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Thickness&quot;</span>);</div><div class="line">        hole_diameter = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Hole diameter&quot;</span>);</div><div class="line">        hole_division_fraction = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Hole division fraction&quot;</span>);</div><div class="line">        n_repetitions_xy = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Number of subdivisions in cross-section&quot;</span>);</div><div class="line">        n_repetitions_z = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Number of subdivisions thickness&quot;</span>);</div><div class="line">        global_refinement = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Global refinement&quot;</span>);</div><div class="line">        <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">scale</a> = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Grid scale&quot;</span>);</div><div class="line">      }</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div><div class="line">    }</div><div class="line">    <span class="keyword">struct </span>Materials</div><div class="line">    {</div><div class="line">      <span class="keywordtype">double</span> nu_e;</div><div class="line">      <span class="keywordtype">double</span> mu_e;</div><div class="line">      <span class="keywordtype">double</span> mu_v;</div><div class="line">      <span class="keywordtype">double</span> tau_v;</div><div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line">      declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">      <span class="keywordtype">void</span></div><div class="line">      parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">    };</div><div class="line">    <span class="keywordtype">void</span> Materials::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Material properties&quot;</span>);</div><div class="line">      {</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Poisson&#39;s ratio&quot;</span>, <span class="stringliteral">&quot;0.4999&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(-1.0,0.5),</div><div class="line">                          <span class="stringliteral">&quot;Poisson&#39;s ratio&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Elastic shear modulus&quot;</span>, <span class="stringliteral">&quot;80.194e6&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div><div class="line">                          <span class="stringliteral">&quot;Elastic shear modulus&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Viscous shear modulus&quot;</span>, <span class="stringliteral">&quot;80.194e6&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div><div class="line">                          <span class="stringliteral">&quot;Viscous shear modulus&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Viscous relaxation time&quot;</span>, <span class="stringliteral">&quot;2.0&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div><div class="line">                          <span class="stringliteral">&quot;Viscous relaxation time&quot;</span>);</div><div class="line">      }</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div><div class="line">    }</div><div class="line">    <span class="keywordtype">void</span> Materials::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Material properties&quot;</span>);</div><div class="line">      {</div><div class="line">        nu_e = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Poisson&#39;s ratio&quot;</span>);</div><div class="line">        mu_e = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Elastic shear modulus&quot;</span>);</div><div class="line">        mu_v = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Viscous shear modulus&quot;</span>);</div><div class="line">        tau_v = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Viscous relaxation time&quot;</span>);</div><div class="line">      }</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div><div class="line">    }</div><div class="line">    <span class="keyword">struct </span>LinearSolver</div><div class="line">    {</div><div class="line">      std::string type_lin;</div><div class="line">      <span class="keywordtype">double</span>      tol_lin;</div><div class="line">      <span class="keywordtype">double</span>      max_iterations_lin;</div><div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line">      declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">      <span class="keywordtype">void</span></div><div class="line">      parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">    };</div><div class="line">    <span class="keywordtype">void</span> LinearSolver::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div><div class="line">      {</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Solver type&quot;</span>, <span class="stringliteral">&quot;cg&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<a class="code" href="classSolverSelector.html">SolverSelector&lt;LA::Vector&gt;::get_solver_names</a>()),</div><div class="line">                          <span class="stringliteral">&quot;Type of solver used to solve the linear system&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Residual&quot;</span>, <span class="stringliteral">&quot;1e-6&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div><div class="line">                          <span class="stringliteral">&quot;Linear solver residual (scaled by residual norm)&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Max iteration multiplier&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(1.0),</div><div class="line">                          <span class="stringliteral">&quot;Linear solver iterations (multiples of the system matrix size)&quot;</span>);</div><div class="line">      }</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div><div class="line">    }</div><div class="line">    <span class="keywordtype">void</span> LinearSolver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div><div class="line">      {</div><div class="line">        type_lin = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Solver type&quot;</span>);</div><div class="line">        tol_lin = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Residual&quot;</span>);</div><div class="line">        max_iterations_lin = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Max iteration multiplier&quot;</span>);</div><div class="line">      }</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div><div class="line">    }</div><div class="line">    <span class="keyword">struct </span>NonlinearSolver</div><div class="line">    {</div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_iterations_NR;</div><div class="line">      <span class="keywordtype">double</span>       tol_f;</div><div class="line">      <span class="keywordtype">double</span>       tol_u;</div><div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line">      declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">      <span class="keywordtype">void</span></div><div class="line">      parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">    };</div><div class="line">    <span class="keywordtype">void</span> NonlinearSolver::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Nonlinear solver&quot;</span>);</div><div class="line">      {</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Max iterations Newton-Raphson&quot;</span>, <span class="stringliteral">&quot;10&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div><div class="line">                          <span class="stringliteral">&quot;Number of Newton-Raphson iterations allowed&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Tolerance displacement&quot;</span>, <span class="stringliteral">&quot;1.0e-6&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div><div class="line">                          <span class="stringliteral">&quot;Displacement error tolerance&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Tolerance force&quot;</span>, <span class="stringliteral">&quot;1.0e-9&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div><div class="line">                          <span class="stringliteral">&quot;Force residual tolerance&quot;</span>);</div><div class="line">      }</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div><div class="line">    }</div><div class="line">    <span class="keywordtype">void</span> NonlinearSolver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Nonlinear solver&quot;</span>);</div><div class="line">      {</div><div class="line">        max_iterations_NR = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Max iterations Newton-Raphson&quot;</span>);</div><div class="line">        tol_f   = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Tolerance force&quot;</span>);</div><div class="line">        tol_u   = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Tolerance displacement&quot;</span>);</div><div class="line">      }</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div><div class="line">    }</div><div class="line">    <span class="keyword">struct </span>Time</div><div class="line">    {</div><div class="line">      <span class="keywordtype">double</span> delta_t;</div><div class="line">      <span class="keywordtype">double</span> end_time;</div><div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line">      declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">      <span class="keywordtype">void</span></div><div class="line">      parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">    };</div><div class="line">    <span class="keywordtype">void</span> Time::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Time&quot;</span>);</div><div class="line">      {</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;End time&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div><div class="line">                          <span class="stringliteral">&quot;End time&quot;</span>);</div><div class="line">        prm.<a class="code" href="classParameterHandler.html#afb951f101e0969416f7f47d24c03bcfa">declare_entry</a>(<span class="stringliteral">&quot;Time step size&quot;</span>, <span class="stringliteral">&quot;0.1&quot;</span>,</div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div><div class="line">                          <span class="stringliteral">&quot;Time step size&quot;</span>);</div><div class="line">      }</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div><div class="line">    }</div><div class="line">    <span class="keywordtype">void</span> Time::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Time&quot;</span>);</div><div class="line">      {</div><div class="line">        end_time = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;End time&quot;</span>);</div><div class="line">        delta_t = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Time step size&quot;</span>);</div><div class="line">      }</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div><div class="line">    }</div><div class="line">    <span class="keyword">struct </span>AllParameters</div><div class="line">      : <span class="keyword">public</span> BoundaryConditions,</div><div class="line">        <span class="keyword">public</span> <a class="code" href="classFESystem.html">FESystem</a>,</div><div class="line">        <span class="keyword">public</span> Geometry,</div><div class="line">        <span class="keyword">public</span> Materials,</div><div class="line">        <span class="keyword">public</span> LinearSolver,</div><div class="line">        <span class="keyword">public</span> NonlinearSolver,</div><div class="line">        <span class="keyword">public</span> Time</div><div class="line">    {</div><div class="line">      AllParameters(<span class="keyword">const</span> std::string &amp;input_file);</div><div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line">      declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">      <span class="keywordtype">void</span></div><div class="line">      parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div><div class="line">    };</div><div class="line">    AllParameters::AllParameters(<span class="keyword">const</span> std::string &amp;input_file)</div><div class="line">    {</div><div class="line">      <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div><div class="line">      declare_parameters(prm);</div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a4f067f0a84ac392fe26d553aea50541b">parse_input</a>(input_file);</div><div class="line">      parse_parameters(prm);</div><div class="line">    }</div><div class="line">    <span class="keywordtype">void</span> AllParameters::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      BoundaryConditions::declare_parameters(prm);</div><div class="line">      FESystem::declare_parameters(prm);</div><div class="line">      Geometry::declare_parameters(prm);</div><div class="line">      Materials::declare_parameters(prm);</div><div class="line">      LinearSolver::declare_parameters(prm);</div><div class="line">      NonlinearSolver::declare_parameters(prm);</div><div class="line">      Time::declare_parameters(prm);</div><div class="line">    }</div><div class="line">    <span class="keywordtype">void</span> AllParameters::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div><div class="line">    {</div><div class="line">      BoundaryConditions::parse_parameters(prm);</div><div class="line">      FESystem::parse_parameters(prm);</div><div class="line">      Geometry::parse_parameters(prm);</div><div class="line">      Materials::parse_parameters(prm);</div><div class="line">      LinearSolver::parse_parameters(prm);</div><div class="line">      NonlinearSolver::parse_parameters(prm);</div><div class="line">      Time::parse_parameters(prm);</div><div class="line">    }</div><div class="line">  }</div><div class="line">  <span class="keyword">class </span>Time</div><div class="line">  {</div><div class="line">  <span class="keyword">public</span>:</div><div class="line">    Time (<span class="keyword">const</span> <span class="keywordtype">double</span> time_end,</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> delta_t)</div><div class="line">      :</div><div class="line">      timestep(0),</div><div class="line">      time_current(0.0),</div><div class="line">      time_end(time_end),</div><div class="line">      delta_t(delta_t)</div><div class="line">    {}</div><div class="line">    <span class="keyword">virtual</span> ~Time()</div><div class="line">    {}</div><div class="line">    <span class="keywordtype">double</span> current()<span class="keyword"> const</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">      <span class="keywordflow">return</span> time_current;</div><div class="line">    }</div><div class="line">    <span class="keywordtype">double</span> end()<span class="keyword"> const</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">      <span class="keywordflow">return</span> time_end;</div><div class="line">    }</div><div class="line">    <span class="keywordtype">double</span> get_delta_t()<span class="keyword"> const</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">      <span class="keywordflow">return</span> delta_t;</div><div class="line">    }</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> get_timestep()<span class="keyword"> const</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">      <span class="keywordflow">return</span> timestep;</div><div class="line">    }</div><div class="line">    <span class="keywordtype">void</span> increment()</div><div class="line">    {</div><div class="line">      time_current += delta_t;</div><div class="line">      ++timestep;</div><div class="line">    }</div><div class="line">  <span class="keyword">private</span>:</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timestep;</div><div class="line">    <span class="keywordtype">double</span>       time_current;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> time_end;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> delta_t;</div><div class="line">  };</div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line">  <span class="keyword">class </span>Material_Compressible_Three_Field_Linear_Viscoelastic</div><div class="line">  {</div><div class="line">  <span class="keyword">public</span>:</div><div class="line">    Material_Compressible_Three_Field_Linear_Viscoelastic(<span class="keyword">const</span> <span class="keywordtype">double</span> mu_e,</div><div class="line">                                                          <span class="keyword">const</span> <span class="keywordtype">double</span> nu_e,</div><div class="line">                                                          <span class="keyword">const</span> <span class="keywordtype">double</span> mu_v,</div><div class="line">                                                          <span class="keyword">const</span> <span class="keywordtype">double</span> tau_v,</div><div class="line">                                                          <span class="keyword">const</span> Time  &amp;time)</div><div class="line">      :</div><div class="line">      kappa((2.0 * mu_e * (1.0 + nu_e)) / (3.0 * (1.0 - 2.0 * nu_e))),</div><div class="line">      mu_e(mu_e),</div><div class="line">      mu_v(mu_v),</div><div class="line">      tau_v(tau_v),</div><div class="line">      time(time),</div><div class="line">      Q_n_t(<a class="code" href="namespacePhysics.html">Physics</a>::Elasticity::StandardTensors&lt;dim&gt;::I),</div><div class="line">      Q_t1(<a class="code" href="namespacePhysics.html">Physics</a>::Elasticity::StandardTensors&lt;dim&gt;::I)</div><div class="line">    {</div><div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(kappa &gt; 0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">    }</div><div class="line">    ~Material_Compressible_Three_Field_Linear_Viscoelastic()</div><div class="line">    {}</div><div class="line"></div><div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2,dim&gt;</a></div><div class="line">    get_tau(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2,dim&gt;</a> &amp;F,</div><div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span>        &amp;p_tilde)<span class="keyword"> const</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">      <span class="keywordflow">return</span> get_tau_iso(F) + get_tau_vol(F,p_tilde);</div><div class="line">    }</div><div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4,dim&gt;</a> get_Jc(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2,dim&gt;</a> &amp;F,</div><div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">double</span>        &amp;p_tilde)<span class="keyword"> const</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">      <span class="keywordflow">return</span> get_Jc_iso(F) + get_Jc_vol(F,p_tilde);</div><div class="line">    }</div><div class="line">    <span class="keywordtype">double</span></div><div class="line">    get_dPsi_vol_dJ(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;J_tilde)<span class="keyword"> const</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">      <span class="keywordflow">return</span> (kappa / 2.0) * (J_tilde - 1.0 / J_tilde);</div><div class="line">    }</div><div class="line">    <span class="keywordtype">double</span></div><div class="line">    get_d2Psi_vol_dJ2(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;J_tilde)<span class="keyword"> const</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">      <span class="keywordflow">return</span> ( (kappa / 2.0) * (1.0 + 1.0 / (J_tilde * J_tilde)));</div><div class="line">    }</div><div class="line">    <span class="keywordtype">void</span></div><div class="line">    update_internal_equilibrium(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;F,</div><div class="line">                                <span class="keyword">const</span> <span class="keywordtype">double</span>         &amp;p_tilde,</div><div class="line">                                <span class="keyword">const</span> <span class="keywordtype">double</span>         &amp;J_tilde)</div><div class="line">    {</div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> det_F = determinant(F);</div><div class="line">      <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2,dim&gt;</a> C_bar = std::pow(det_F, -2.0 / dim) * <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a09916360abaee5f1fb31994dbc96787b">Physics::Elasticity::Kinematics::C</a>(F);</div></div><!-- fragment --><p>Linder2011 eq 54 Assumes first-oder backward Euler time discretisation</p>
<div class="fragment"><div class="line">    Q_n_t = (1.0/(1.0 + time.get_delta_t()/tau_v))*(Q_t1 + (time.get_delta_t()/tau_v)*<a class="code" href="classSymmetricTensor.html#a6270f4610919ac288e2bb142588c1b2f">invert</a>(C_bar));</div><div class="line">  }</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  update_end_timestep()</div><div class="line">  {</div><div class="line">    Q_t1 = Q_n_t;</div><div class="line">  }</div><div class="line"></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> kappa;</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> mu_e;</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> mu_v;</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> tau_v;</div><div class="line">  <span class="keyword">const</span> Time  &amp;time;</div><div class="line">  <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2,dim&gt;</a> Q_n_t; <span class="comment">// Value of internal variable at this Newton step and timestep</span></div><div class="line">  <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2,dim&gt;</a> Q_t1; <span class="comment">// Value of internal variable at the previous timestep</span></div><div class="line"></div><div class="line">  <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a></div><div class="line">  get_tau_vol(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2,dim&gt;</a> &amp;F,</div><div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span>        &amp;p_tilde)<span class="keyword"> const</span></div><div class="line"><span class="keyword">  </span>{</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> det_F = <a class="code" href="classSymmetricTensor.html#a31d48ca1d251a7a32db8b673e6010193">determinant</a>(F);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> p_tilde * det_F * <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>;</div><div class="line">  }</div><div class="line">  <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a></div><div class="line">  get_tau_iso(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2,dim&gt;</a> &amp;F)<span class="keyword"> const</span></div><div class="line"><span class="keyword">  </span>{</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a> * get_tau_bar(F);</div><div class="line">  }</div><div class="line">  <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a></div><div class="line">  get_tau_bar(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2,dim&gt;</a> &amp;F)<span class="keyword"> const</span></div><div class="line"><span class="keyword">  </span>{</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> det_F = <a class="code" href="classSymmetricTensor.html#a31d48ca1d251a7a32db8b673e6010193">determinant</a>(F);</div><div class="line">    <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2,dim&gt;</a> F_bar = std::pow(det_F, -1.0 / dim) * F;</div><div class="line">    <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2,dim&gt;</a> b_bar = std::pow(det_F, -2.0 / dim) * <a class="code" href="classSymmetricTensor.html#a4acdda923e9b04d2d70308f3c095e12f">symmetrize</a>(F * <a class="code" href="classDerivativeForm.html#a3c201452e8dd28e4f5be4a316cb9305f">transpose</a>(F));</div></div><!-- fragment --><p>Elastic Neo-Hookean + Linder2011 eq 47</p>
<div class="fragment"><div class="line">  <span class="keywordflow">return</span> mu_e * b_bar</div><div class="line">         + mu_v * <a class="code" href="classSymmetricTensor.html#a4acdda923e9b04d2d70308f3c095e12f">symmetrize</a>(F_bar*<span class="keyword">static_cast&lt;</span><a class="code" href="classTensor.html">Tensor&lt;2,dim&gt;</a> <span class="keyword">&gt;</span>(Q_n_t)*<a class="code" href="classDerivativeForm.html#a3c201452e8dd28e4f5be4a316cb9305f">transpose</a>(F_bar));</div><div class="line">}</div><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_Jc_vol(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2,dim&gt;</a> &amp;F,</div><div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">double</span>        &amp;p_tilde)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> det_F = <a class="code" href="classSymmetricTensor.html#a31d48ca1d251a7a32db8b673e6010193">determinant</a>(F);</div><div class="line">  <span class="keywordflow">return</span> p_tilde * det_F</div><div class="line">         * ( <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::IxI</a></div><div class="line">             - (2.0 * <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::S</a>) );</div><div class="line">}</div><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_Jc_iso(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2,dim&gt;</a> &amp;F)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">  <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau_bar = get_tau_bar(F);</div><div class="line">  <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau_iso = get_tau_iso(F);</div><div class="line">  <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> tau_iso_x_I</div><div class="line">    = <a class="code" href="classSymmetricTensor.html#ad8e50332a8602d09d12091217f775bec">outer_product</a>(tau_iso,</div><div class="line">                    <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>);</div><div class="line">  <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> I_x_tau_iso</div><div class="line">    = <a class="code" href="classSymmetricTensor.html#ad8e50332a8602d09d12091217f775bec">outer_product</a>(<a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>,</div><div class="line">                    tau_iso);</div><div class="line">  <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> c_bar = get_c_bar(F);</div><div class="line">  <span class="keywordflow">return</span> (2.0 / dim) * <a class="code" href="classSymmetricTensor.html#a05096e7bc18fa734eae3bd1a5f08138e">trace</a>(tau_bar)</div><div class="line">         * <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a></div><div class="line">         - (2.0 / dim) * (tau_iso_x_I + I_x_tau_iso)</div><div class="line">         + <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a> * c_bar</div><div class="line">         * <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a>;</div><div class="line">}</div><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_c_bar(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2,dim&gt;</a> &amp;F)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div></div><!-- fragment --><p>Elastic Neo-Hookean + Linder2011 eq 56</p>
<div class="fragment"><div class="line">    <span class="keywordflow">return</span> -2.0*mu_v*((time.get_delta_t()/tau_v)/(1.0 + time.get_delta_t()/tau_v))*<a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::S</a>;</div><div class="line">  }</div><div class="line">};</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keyword">class </span>PointHistory</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  PointHistory()</div><div class="line">  {}</div><div class="line">  <span class="keyword">virtual</span> ~PointHistory()</div><div class="line">  {}</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  setup_lqp (<span class="keyword">const</span> Parameters::AllParameters &amp;parameters,</div><div class="line">             <span class="keyword">const</span> Time                      &amp;time)</div><div class="line">  {</div><div class="line">    material.reset(<span class="keyword">new</span> Material_Compressible_Three_Field_Linear_Viscoelastic&lt;dim&gt;(</div><div class="line">                     parameters.mu_e, parameters.nu_e,</div><div class="line">                     parameters.mu_v, parameters.tau_v,</div><div class="line">                     time));</div><div class="line">  }</div><div class="line"></div><div class="line">  <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a></div><div class="line">  get_tau(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;F,</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span>         &amp;p_tilde)<span class="keyword"> const</span></div><div class="line"><span class="keyword">  </span>{</div><div class="line">    <span class="keywordflow">return</span> material-&gt;get_tau(F, p_tilde);</div><div class="line">  }</div><div class="line">  <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a></div><div class="line">  get_Jc(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;F,</div><div class="line">         <span class="keyword">const</span> <span class="keywordtype">double</span>         &amp;p_tilde)<span class="keyword"> const</span></div><div class="line"><span class="keyword">  </span>{</div><div class="line">    <span class="keywordflow">return</span> material-&gt;get_Jc(F, p_tilde);</div><div class="line">  }</div><div class="line">  <span class="keywordtype">double</span></div><div class="line">  get_dPsi_vol_dJ(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;J_tilde)<span class="keyword"> const</span></div><div class="line"><span class="keyword">  </span>{</div><div class="line">    <span class="keywordflow">return</span> material-&gt;get_dPsi_vol_dJ(J_tilde);</div><div class="line">  }</div><div class="line">  <span class="keywordtype">double</span></div><div class="line">  get_d2Psi_vol_dJ2(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;J_tilde)<span class="keyword"> const</span></div><div class="line"><span class="keyword">  </span>{</div><div class="line">    <span class="keywordflow">return</span> material-&gt;get_d2Psi_vol_dJ2(J_tilde);</div><div class="line">  }</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  update_internal_equilibrium(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;F,</div><div class="line">                              <span class="keyword">const</span> <span class="keywordtype">double</span>         &amp;p_tilde,</div><div class="line">                              <span class="keyword">const</span> <span class="keywordtype">double</span>         &amp;J_tilde)</div><div class="line">  {</div><div class="line">    material-&gt;update_internal_equilibrium(F,p_tilde,J_tilde);</div><div class="line">  }</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  update_end_timestep()</div><div class="line">  {</div><div class="line">    material-&gt;update_end_timestep();</div><div class="line">  }</div><div class="line"><span class="keyword">private</span>:</div><div class="line">  std_cxx11::shared_ptr&lt; Material_Compressible_Three_Field_Linear_Viscoelastic&lt;dim&gt; &gt; material;</div><div class="line">};</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keyword">class </span>Solid</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  Solid(<span class="keyword">const</span> std::string &amp;input_file);</div><div class="line">  <span class="keyword">virtual</span></div><div class="line">  ~Solid();</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  run();</div><div class="line"><span class="keyword">private</span>:</div><div class="line">  <span class="keyword">struct </span>PerTaskData_ASM;</div><div class="line">  <span class="keyword">struct </span>ScratchData_ASM;</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  make_grid();</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  make_2d_quarter_plate_with_hole(<a class="code" href="classTriangulation.html">Triangulation&lt;2&gt;</a> &amp;tria_2d,</div><div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">double</span> half_length,</div><div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">double</span> half_width,</div><div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">double</span> hole_radius,</div><div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_repetitions_xy = 1,</div><div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">double</span> hole_division_fraction = 0.25);</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  setup_system(LA::MPI::BlockVector &amp;solution_delta);</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  determine_component_extractors();</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  assemble_system(<span class="keyword">const</span> LA::MPI::BlockVector &amp;solution_delta);</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  assemble_system_one_cell(<span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div><div class="line">                           ScratchData_ASM &amp;scratch,</div><div class="line">                           PerTaskData_ASM &amp;data) <span class="keyword">const</span>;</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  copy_local_to_global_system(<span class="keyword">const</span> PerTaskData_ASM &amp;data);</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  make_constraints(<span class="keyword">const</span> <span class="keywordtype">int</span> &amp;it_nr);</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  setup_qph();</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  solve_nonlinear_timestep(LA::MPI::BlockVector &amp;solution_delta);</div><div class="line">  std::pair&lt;unsigned int, double&gt;</div><div class="line">  solve_linear_system(LA::MPI::BlockVector &amp;newton_update);</div><div class="line">  LA::MPI::BlockVector</div><div class="line">  get_solution_total(<span class="keyword">const</span> LA::MPI::BlockVector &amp;solution_delta) <span class="keyword">const</span>;</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  update_end_timestep();</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timestep,</div><div class="line">                 <span class="keyword">const</span> <span class="keywordtype">double</span>       current_time) <span class="keyword">const</span>;</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  compute_vertex_positions(std::vector&lt;double&gt; &amp;real_time,</div><div class="line">                           std::vector&lt;std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &gt; &gt; &amp;tracked_vertices,</div><div class="line">                           <span class="keyword">const</span> LA::MPI::BlockVector &amp;solution_total) <span class="keyword">const</span>;</div></div><!-- fragment --><p>Parallel communication</p>
<div class="fragment"><div class="line">MPI_Comm                         mpi_communicator;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>               n_mpi_processes;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>               <a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">this_mpi_process</a>;</div><div class="line"><span class="keyword">mutable</span> <a class="code" href="classConditionalOStream.html">ConditionalOStream</a>       pcout;</div><div class="line"></div><div class="line">Parameters::AllParameters parameters;</div><div class="line"><a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a>        triangulation;</div><div class="line">Time                      time;</div><div class="line"><span class="keyword">mutable</span> <a class="code" href="classTimerOutput.html">TimerOutput</a>       timer;</div><div class="line"><a class="code" href="classCellDataStorage.html">CellDataStorage&lt;typename Triangulation&lt;dim&gt;::cell_iterator</a>,</div><div class="line">                PointHistory&lt;dim&gt; &gt; quadrature_point_history;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>               degree;</div><div class="line"><span class="keyword">const</span> <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a>              fe;</div><div class="line"><a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>                  dof_handler;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>               dofs_per_cell;</div><div class="line"><span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Vector.html">FEValuesExtractors::Vector</a> u_fe;</div><div class="line"><span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> p_fe;</div><div class="line"><span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> J_fe;</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_blocks = 3;</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_components = dim + 2;</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> first_u_component = 0;</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p_component = dim;</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> J_component = dim + 1;</div><div class="line"><span class="keyword">enum</span></div><div class="line">{</div><div class="line">  u_block = 0,</div><div class="line">  p_block = 1,</div><div class="line">  J_block = 2</div><div class="line">};</div></div><!-- fragment --><p>Block data</p>
<div class="fragment"><div class="line">std::vector&lt;unsigned int&gt; block_component;</div></div><!-- fragment --><p>DoF index data</p>
<div class="fragment"><div class="line">  std::vector&lt;IndexSet&gt; all_locally_owned_dofs;</div><div class="line">  <a class="code" href="classIndexSet.html">IndexSet</a> locally_owned_dofs;</div><div class="line">  <a class="code" href="classIndexSet.html">IndexSet</a> locally_relevant_dofs;</div><div class="line">  std::vector&lt;IndexSet&gt; locally_owned_partitioning;</div><div class="line">  std::vector&lt;IndexSet&gt; locally_relevant_partitioning;</div><div class="line">  std::vector&lt;types::global_dof_index&gt; dofs_per_block;</div><div class="line">  std::vector&lt;types::global_dof_index&gt; element_indices_u;</div><div class="line">  std::vector&lt;types::global_dof_index&gt; element_indices_p;</div><div class="line">  std::vector&lt;types::global_dof_index&gt; element_indices_J;</div><div class="line">  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>     qf_cell;</div><div class="line">  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss</a>&lt;dim - 1&gt; qf_face;</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    n_q_points;</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    n_q_points_f;</div><div class="line">  <a class="code" href="classConstraintMatrix.html">ConstraintMatrix</a>      constraints;</div><div class="line">  LA::BlockSparseMatrix tangent_matrix;</div><div class="line">  LA::MPI::BlockVector  system_rhs;</div><div class="line">  LA::MPI::BlockVector  solution_n;</div><div class="line">  <span class="keyword">struct </span>Errors</div><div class="line">  {</div><div class="line">    Errors()</div><div class="line">      :</div><div class="line">      norm(1.0), u(1.0), p(1.0), J(1.0)</div><div class="line">    {}</div><div class="line">    <span class="keywordtype">void</span> reset()</div><div class="line">    {</div><div class="line">      norm = 1.0;</div><div class="line">      u = 1.0;</div><div class="line">      p = 1.0;</div><div class="line">      J = 1.0;</div><div class="line">    }</div><div class="line">    <span class="keywordtype">void</span> normalise(<span class="keyword">const</span> Errors &amp;rhs)</div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> (rhs.norm != 0.0)</div><div class="line">        norm /= rhs.norm;</div><div class="line">      <span class="keywordflow">if</span> (rhs.u != 0.0)</div><div class="line">        u /= rhs.u;</div><div class="line">      <span class="keywordflow">if</span> (rhs.p != 0.0)</div><div class="line">        p /= rhs.p;</div><div class="line">      <span class="keywordflow">if</span> (rhs.J != 0.0)</div><div class="line">        J /= rhs.J;</div><div class="line">    }</div><div class="line">    <span class="keywordtype">double</span> norm, u, p, J;</div><div class="line">  };</div><div class="line">  Errors error_residual, error_residual_0, error_residual_norm, error_update,</div><div class="line">         error_update_0, error_update_norm;</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  get_error_residual(Errors &amp;error_residual);</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  get_error_update(<span class="keyword">const</span> LA::MPI::BlockVector &amp;newton_update,</div><div class="line">                   Errors &amp;error_update);</div><div class="line">  std::pair&lt;double, std::pair&lt;double,double&gt; &gt;</div><div class="line">  get_error_dilation(<span class="keyword">const</span> LA::MPI::BlockVector &amp;solution_total) <span class="keyword">const</span>;</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  print_conv_header();</div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  print_conv_footer(<span class="keyword">const</span> LA::MPI::BlockVector &amp;solution_delta);</div><div class="line">};</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line">Solid&lt;dim&gt;::Solid(<span class="keyword">const</span> std::string &amp;input_file)</div><div class="line">  :</div><div class="line">  mpi_communicator(MPI_COMM_WORLD),</div><div class="line">  n_mpi_processes (<a class="code" href="namespaceUtilities.html">Utilities</a>::MPI::n_mpi_processes(mpi_communicator)),</div><div class="line">  this_mpi_process (<a class="code" href="namespaceUtilities.html">Utilities</a>::MPI::this_mpi_process(mpi_communicator)),</div><div class="line">  pcout(<a class="code" href="namespacestd.html">std</a>::cout, this_mpi_process == 0),</div><div class="line">  parameters(input_file),</div><div class="line">  triangulation(<a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::maximum_smoothing),</div><div class="line">  time(parameters.end_time, parameters.delta_t),</div><div class="line">  timer(mpi_communicator,</div><div class="line">        pcout,</div><div class="line">        <a class="code" href="classTimerOutput.html">TimerOutput</a>::summary,</div><div class="line">        <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times),</div><div class="line">  degree(parameters.poly_degree),</div><div class="line">  fe(<a class="code" href="classFE__Q.html">FE_Q</a>&lt;dim&gt;(parameters.poly_degree), dim, <span class="comment">// displacement</span></div><div class="line">     <a class="code" href="classFE__DGPMonomial.html">FE_DGPMonomial</a>&lt;dim&gt;(parameters.poly_degree - 1), 1, <span class="comment">// pressure</span></div><div class="line">     <a class="code" href="classFE__DGPMonomial.html">FE_DGPMonomial</a>&lt;dim&gt;(parameters.poly_degree - 1), 1), <span class="comment">// dilatation</span></div><div class="line">  dof_handler(triangulation),</div><div class="line">  dofs_per_cell (fe.dofs_per_cell),</div><div class="line">  u_fe(first_u_component),</div><div class="line">  p_fe(p_component),</div><div class="line">  J_fe(J_component),</div><div class="line">  dofs_per_block(n_blocks),</div><div class="line">  qf_cell(parameters.quad_order),</div><div class="line">  qf_face(parameters.quad_order),</div><div class="line">  n_q_points (qf_cell.size()),</div><div class="line">  n_q_points_f (qf_face.size())</div><div class="line">{</div><div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(dim==2 || dim==3, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;This problem only works in 2 or 3 space dimensions.&quot;</span>));</div><div class="line">  determine_component_extractors();</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line">Solid&lt;dim&gt;::~Solid()</div><div class="line">{</div><div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#ad316958f8045d9a48094335b23a03a53">clear</a>();</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::run()</div><div class="line">{</div><div class="line">  LA::MPI::BlockVector solution_delta;</div><div class="line"></div><div class="line">  make_grid();</div><div class="line">  setup_system(solution_delta);</div><div class="line">  {</div><div class="line">    <a class="code" href="classConstraintMatrix.html">ConstraintMatrix</a> constraints;</div><div class="line">    constraints.<a class="code" href="classConstraintMatrix.html#a8056d07faa2a7ed3f158c1b42d56abc8">close</a>();</div><div class="line">    <span class="keyword">const</span> <a class="code" href="classComponentSelectFunction.html">ComponentSelectFunction&lt;dim&gt;</a></div><div class="line">    J_mask (J_component, n_components);</div><div class="line">    <a class="code" href="namespaceVectorTools.html#ac68694d99266fa35e252f424f35d9f95">VectorTools::project</a> (dof_handler,</div><div class="line">                          constraints,</div><div class="line">                          <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(degree+2),</div><div class="line">                          J_mask,</div><div class="line">                          solution_n);</div><div class="line">  }</div><div class="line">  output_results(time.get_timestep(), time.current());</div><div class="line">  time.increment();</div></div><!-- fragment --><p>Some points for post-processing</p>
<div class="fragment"><div class="line">  std::vector&lt;double&gt; real_time;</div><div class="line">  real_time.push_back(0);</div><div class="line">  std::vector&lt;std::vector&lt;Point&lt;dim&gt; &gt; &gt; tracked_vertices (4);</div><div class="line">  {</div><div class="line">    <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> p;</div><div class="line">    p[1] = parameters.length/2.0;</div><div class="line">    tracked_vertices[0].push_back(p*parameters.scale);</div><div class="line">  }</div><div class="line">  {</div><div class="line">    <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> p;</div><div class="line">    p[1] = parameters.hole_diameter/2.0;</div><div class="line">    tracked_vertices[1].push_back(p*parameters.scale);</div><div class="line">  }</div><div class="line">  {</div><div class="line">    <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> p;</div><div class="line">    p[0] = parameters.hole_diameter/2.0;</div><div class="line">    tracked_vertices[2].push_back(p*parameters.scale);</div><div class="line">  }</div><div class="line">  {</div><div class="line">    <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> p;</div><div class="line">    p[0] = parameters.width/2.0;</div><div class="line">    tracked_vertices[3].push_back(p*parameters.scale);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">while</span> (time.current() &lt; time.end()+0.01*time.get_delta_t())</div><div class="line">    {</div><div class="line">      solve_nonlinear_timestep(solution_delta);</div><div class="line">      solution_n += solution_delta;</div><div class="line">      solution_delta = 0.0;</div><div class="line">      output_results(time.get_timestep(), time.current());</div><div class="line">      compute_vertex_positions(real_time,</div><div class="line">                               tracked_vertices,</div><div class="line">                               get_solution_total(solution_delta));</div><div class="line">      update_end_timestep();</div><div class="line">      time.increment();</div><div class="line">    }</div><div class="line"></div><div class="line">  pcout &lt;&lt; <span class="stringliteral">&quot;\n\n*** Spatial position history for tracked vertices ***&quot;</span> &lt;&lt; std::endl;</div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t=0; t&lt;real_time.size(); ++t)</div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> (t == 0)</div><div class="line">        {</div><div class="line">          pcout &lt;&lt; <span class="stringliteral">&quot;Time,&quot;</span>;</div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p=0; p&lt;tracked_vertices.size(); ++p)</div><div class="line">            {</div><div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d=0; d&lt;dim; ++d)</div><div class="line">                {</div><div class="line">                  pcout &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; p &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; d &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div><div class="line">                  <span class="keywordflow">if</span> (!(p == tracked_vertices.size()-1 &amp; d == dim-1))</div><div class="line">                    pcout &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line">                }</div><div class="line">            }</div><div class="line">          pcout &lt;&lt; std::endl;</div><div class="line">        }</div><div class="line"></div><div class="line">      pcout &lt;&lt; std::setprecision(6);</div><div class="line">      pcout &lt;&lt; real_time[t] &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p=0; p&lt;tracked_vertices.size(); ++p)</div><div class="line">        {</div><div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(tracked_vertices[p].size() == real_time.size(),</div><div class="line">                 <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Vertex not tracked at each timestep&quot;</span>));</div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d=0; d&lt;dim; ++d)</div><div class="line">            {</div><div class="line">              pcout &lt;&lt; tracked_vertices[p][t][d];</div><div class="line">              <span class="keywordflow">if</span> (!(p == tracked_vertices.size()-1 &amp; d == dim-1))</div><div class="line">                pcout &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">      pcout &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keyword">struct </span>Solid&lt;dim&gt;::PerTaskData_ASM</div><div class="line">{</div><div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>        cell_matrix;</div><div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>            cell_rhs;</div><div class="line">  std::vector&lt;types::global_dof_index&gt; local_dof_indices;</div><div class="line">  PerTaskData_ASM(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell)</div><div class="line">    :</div><div class="line">    cell_matrix(dofs_per_cell, dofs_per_cell),</div><div class="line">    cell_rhs(dofs_per_cell),</div><div class="line">    local_dof_indices(dofs_per_cell)</div><div class="line">  {}</div><div class="line">  <span class="keywordtype">void</span> reset()</div><div class="line">  {</div><div class="line">    cell_matrix = 0.0;</div><div class="line">    cell_rhs = 0.0;</div><div class="line">  }</div><div class="line">};</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keyword">struct </span>Solid&lt;dim&gt;::ScratchData_ASM</div><div class="line">{</div><div class="line">  <span class="keyword">const</span> LA::MPI::BlockVector &amp;solution_total;</div></div><!-- fragment --><p>Integration helper</p>
<div class="fragment"><div class="line"><a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>              fe_values_ref;</div><div class="line"><a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a>          fe_face_values_ref;</div></div><!-- fragment --><p><a class="el" href="classQuadrature.html">Quadrature</a> point solution</p>
<div class="fragment"><div class="line">std::vector&lt;Tensor&lt;2, dim&gt; &gt; solution_grads_u_total;</div><div class="line">std::vector&lt;double&gt;          solution_values_p_total;</div><div class="line">std::vector&lt;double&gt;          solution_values_J_total;</div></div><!-- fragment --><p>Shape function values and gradients</p>
<div class="fragment"><div class="line">  std::vector&lt;std::vector&lt;double&gt; &gt;                   Nx;</div><div class="line">  std::vector&lt;std::vector&lt;Tensor&lt;2, dim&gt; &gt; &gt;          grad_Nx;</div><div class="line">  std::vector&lt;std::vector&lt;SymmetricTensor&lt;2, dim&gt; &gt; &gt; symm_grad_Nx;</div><div class="line"></div><div class="line">  ScratchData_ASM(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;fe_cell,</div><div class="line">                  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> &amp;qf_cell, <span class="keyword">const</span> <a class="code" href="group__feaccess.html#gaa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_cell,</div><div class="line">                  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim - 1&gt;</a> &amp; qf_face, <span class="keyword">const</span> <a class="code" href="group__feaccess.html#gaa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_face,</div><div class="line">                  <span class="keyword">const</span> LA::MPI::BlockVector &amp;solution_total)</div><div class="line">    :</div><div class="line">    solution_total (solution_total),</div><div class="line">    fe_values_ref(fe_cell, qf_cell, uf_cell),</div><div class="line">    fe_face_values_ref(fe_cell, qf_face, uf_face),</div><div class="line">    solution_grads_u_total(qf_cell.size()),</div><div class="line">    solution_values_p_total(qf_cell.size()),</div><div class="line">    solution_values_J_total(qf_cell.size()),</div><div class="line">    Nx(qf_cell.size(),</div><div class="line">       <a class="code" href="namespacestd.html">std</a>::vector&lt;double&gt;(fe_cell.dofs_per_cell)),</div><div class="line">    grad_Nx(qf_cell.size(),</div><div class="line">            <a class="code" href="namespacestd.html">std</a>::vector&lt;<a class="code" href="classTensor.html">Tensor</a>&lt;2, dim&gt; &gt;(fe_cell.dofs_per_cell)),</div><div class="line">    symm_grad_Nx(qf_cell.size(),</div><div class="line">                 <a class="code" href="namespacestd.html">std</a>::vector&lt;<a class="code" href="classSymmetricTensor.html">SymmetricTensor</a>&lt;2, dim&gt; &gt;</div><div class="line">                 (fe_cell.dofs_per_cell))</div><div class="line">  {}</div><div class="line">  ScratchData_ASM(<span class="keyword">const</span> ScratchData_ASM &amp;rhs)</div><div class="line">    :</div><div class="line">    solution_total (rhs.solution_total),</div><div class="line">    fe_values_ref(rhs.fe_values_ref.get_fe(),</div><div class="line">                  rhs.fe_values_ref.get_quadrature(),</div><div class="line">                  rhs.fe_values_ref.get_update_flags()),</div><div class="line">    fe_face_values_ref(rhs.fe_face_values_ref.get_fe(),</div><div class="line">                       rhs.fe_face_values_ref.get_quadrature(),</div><div class="line">                       rhs.fe_face_values_ref.get_update_flags()),</div><div class="line">    solution_grads_u_total(rhs.solution_grads_u_total),</div><div class="line">    solution_values_p_total(rhs.solution_values_p_total),</div><div class="line">    solution_values_J_total(rhs.solution_values_J_total),</div><div class="line">    Nx(rhs.Nx),</div><div class="line">    grad_Nx(rhs.grad_Nx),</div><div class="line">    symm_grad_Nx(rhs.symm_grad_Nx)</div><div class="line">  {}</div><div class="line">  <span class="keywordtype">void</span> reset()</div><div class="line">  {</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points = solution_grads_u_total.size();</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs_per_cell = Nx[0].size();</div><div class="line"></div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(solution_grads_u_total.size() == n_q_points,</div><div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(solution_values_p_total.size() == n_q_points,</div><div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(solution_values_J_total.size() == n_q_points,</div><div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(Nx.size() == n_q_points,</div><div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(grad_Nx.size() == n_q_points,</div><div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(symm_grad_Nx.size() == n_q_points,</div><div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div><div class="line">      {</div><div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>( Nx[q_point].size() == n_dofs_per_cell, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>( grad_Nx[q_point].size() == n_dofs_per_cell,</div><div class="line">                <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>( symm_grad_Nx[q_point].size() == n_dofs_per_cell,</div><div class="line">                <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line"></div><div class="line">        solution_grads_u_total[q_point] = 0.0;</div><div class="line">        solution_values_p_total[q_point] = 0.0;</div><div class="line">        solution_values_J_total[q_point] = 0.0;</div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; n_dofs_per_cell; ++k)</div><div class="line">          {</div><div class="line">            Nx[q_point][k] = 0.0;</div><div class="line">            grad_Nx[q_point][k] = 0.0;</div><div class="line">            symm_grad_Nx[q_point][k] = 0.0;</div><div class="line">          }</div><div class="line">      }</div><div class="line">  }</div><div class="line">};</div><div class="line"><span class="keyword">template</span> &lt;&gt;</div><div class="line"><span class="keywordtype">void</span> Solid&lt;2&gt;::make_grid()</div><div class="line">{</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">int</span> dim = 2;</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> tol = 1e-12;</div><div class="line">  make_2d_quarter_plate_with_hole(triangulation,</div><div class="line">                                  parameters.length/2.0,</div><div class="line">                                  parameters.width/2.0,</div><div class="line">                                  parameters.hole_diameter/2.0,</div><div class="line">                                  parameters.n_repetitions_xy,</div><div class="line">                                  parameters.hole_division_fraction);</div></div><!-- fragment --><p>Clear boundary ID's</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">typename</span> <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;::active_cell_iterator</a></div><div class="line">     cell = triangulation.<a class="code" href="classTriangulation.html#a9388e821c728eab8d0e699d0ca112482">begin_active</a>();</div><div class="line">     cell != triangulation.<a class="code" href="classTriangulation.html#afdbd22694fb7591e822577a8f8a90de9">end</a>(); ++cell)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> face=0; face&lt;GeometryInfo&lt;dim&gt;::faces_per_cell; ++face)</div><div class="line">      <span class="keywordflow">if</span> (cell-&gt;face(face)-&gt;at_boundary())</div><div class="line">        {</div><div class="line">          cell-&gt;face(face)-&gt;set_all_boundary_ids(0);</div><div class="line">        }</div><div class="line">  }</div></div><!-- fragment --><p>Set boundary IDs and and manifolds</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> centre (0,0);</div><div class="line"><span class="keywordflow">for</span> (<span class="keyword">typename</span> <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;::active_cell_iterator</a></div><div class="line">     cell = triangulation.<a class="code" href="classTriangulation.html#a9388e821c728eab8d0e699d0ca112482">begin_active</a>();</div><div class="line">     cell != triangulation.<a class="code" href="classTriangulation.html#afdbd22694fb7591e822577a8f8a90de9">end</a>(); ++cell)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> face=0; face&lt;GeometryInfo&lt;dim&gt;::faces_per_cell; ++face)</div><div class="line">      <span class="keywordflow">if</span> (cell-&gt;face(face)-&gt;at_boundary())</div><div class="line">        {</div></div><!-- fragment --><p>Set boundary IDs</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (std::abs(cell-&gt;face(face)-&gt;center()[0] - 0.0) &lt; tol)</div><div class="line">  {</div><div class="line">    cell-&gt;face(face)-&gt;set_boundary_id(parameters.boundary_id_minus_X);</div><div class="line">  }</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (std::abs(cell-&gt;face(face)-&gt;center()[0] - parameters.width/2.0) &lt; tol)</div><div class="line">  {</div><div class="line">    cell-&gt;face(face)-&gt;set_boundary_id(parameters.boundary_id_plus_X);</div><div class="line">  }</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (std::abs(cell-&gt;face(face)-&gt;center()[1] - 0.0) &lt; tol)</div><div class="line">  {</div><div class="line">    cell-&gt;face(face)-&gt;set_boundary_id(parameters.boundary_id_minus_Y);</div><div class="line">  }</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (std::abs(cell-&gt;face(face)-&gt;center()[1] - parameters.length/2.0) &lt; tol)</div><div class="line">  {</div><div class="line">    cell-&gt;face(face)-&gt;set_boundary_id(parameters.boundary_id_plus_Y);</div><div class="line">  }</div><div class="line"><span class="keywordflow">else</span></div><div class="line">  {</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertex=0; vertex&lt;GeometryInfo&lt;dim&gt;::vertices_per_face; ++vertex)</div><div class="line">      <span class="keywordflow">if</span> (std::abs(cell-&gt;vertex(vertex).distance(centre) - parameters.hole_diameter/2.0) &lt; tol)</div><div class="line">        {</div><div class="line">          cell-&gt;face(face)-&gt;set_boundary_id(parameters.boundary_id_hole);</div><div class="line">          <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">  }</div></div><!-- fragment --><p>Set manifold IDs</p>
<div class="fragment"><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertex=0; vertex&lt;GeometryInfo&lt;dim&gt;::vertices_per_face; ++vertex)</div><div class="line">              <span class="keywordflow">if</span> (std::abs(cell-&gt;vertex(vertex).distance(centre) - parameters.hole_diameter/2.0) &lt; tol)</div><div class="line">                {</div><div class="line">                  cell-&gt;face(face)-&gt;set_manifold_id(parameters.manifold_id_hole);</div><div class="line">                  <span class="keywordflow">break</span>;</div><div class="line">                }</div><div class="line">          }</div><div class="line">    }</div><div class="line">  <span class="keyword">static</span> <a class="code" href="classSphericalManifold.html">SphericalManifold&lt;dim&gt;</a> spherical_manifold (centre);</div><div class="line">  triangulation.<a class="code" href="group__manifold.html#ga9f9d720f5fbdcdf3dcbb445feefbdb9f">set_manifold</a>(parameters.manifold_id_hole,spherical_manifold);</div><div class="line">  triangulation.<a class="code" href="classTriangulation.html#a6ad0b3fb24aae17f4668427a433dea19">refine_global</a>(parameters.global_refinement);</div><div class="line">  <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">GridTools::scale</a>(parameters.scale,triangulation);</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;&gt;</div><div class="line"><span class="keywordtype">void</span> Solid&lt;3&gt;::make_grid()</div><div class="line">{</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">int</span> dim = 3;</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> tol = 1e-12;</div><div class="line">  <a class="code" href="classTriangulation.html">Triangulation&lt;2&gt;</a> tria_2d;</div><div class="line">  make_2d_quarter_plate_with_hole(tria_2d,</div><div class="line">                                  parameters.length/2.0,</div><div class="line">                                  parameters.width/2.0,</div><div class="line">                                  parameters.hole_diameter/2.0,</div><div class="line">                                  parameters.n_repetitions_xy,</div><div class="line">                                  parameters.hole_division_fraction);</div><div class="line">  <a class="code" href="namespaceGridGenerator.html#add67475b53b365d65a3fe3eb6f156fa9">GridGenerator::extrude_triangulation</a>(tria_2d,</div><div class="line">                                       parameters.n_repetitions_z+1,</div><div class="line">                                       parameters.thickness/2.0,</div><div class="line">                                       triangulation);</div></div><!-- fragment --><p>Clear boundary ID's</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">typename</span> <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;::active_cell_iterator</a></div><div class="line">     cell = triangulation.<a class="code" href="classTriangulation.html#a9388e821c728eab8d0e699d0ca112482">begin_active</a>();</div><div class="line">     cell != triangulation.<a class="code" href="classTriangulation.html#afdbd22694fb7591e822577a8f8a90de9">end</a>(); ++cell)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> face=0; face&lt;GeometryInfo&lt;dim&gt;::faces_per_cell; ++face)</div><div class="line">      <span class="keywordflow">if</span> (cell-&gt;face(face)-&gt;at_boundary())</div><div class="line">        {</div><div class="line">          cell-&gt;face(face)-&gt;set_all_boundary_ids(0);</div><div class="line">        }</div><div class="line">  }</div></div><!-- fragment --><p>Set boundary IDs and and manifolds</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> direction (0,0,1);</div><div class="line"><span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> centre (0,0,0);</div><div class="line"><span class="keywordflow">for</span> (<span class="keyword">typename</span> <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;::active_cell_iterator</a></div><div class="line">     cell = triangulation.<a class="code" href="classTriangulation.html#a9388e821c728eab8d0e699d0ca112482">begin_active</a>();</div><div class="line">     cell != triangulation.<a class="code" href="classTriangulation.html#afdbd22694fb7591e822577a8f8a90de9">end</a>(); ++cell)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> face=0; face&lt;GeometryInfo&lt;dim&gt;::faces_per_cell; ++face)</div><div class="line">      <span class="keywordflow">if</span> (cell-&gt;face(face)-&gt;at_boundary())</div><div class="line">        {</div></div><!-- fragment --><p>Set boundary IDs</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (std::abs(cell-&gt;face(face)-&gt;center()[0] - 0.0) &lt; tol)</div><div class="line">  {</div><div class="line">    cell-&gt;face(face)-&gt;set_boundary_id(parameters.boundary_id_minus_X);</div><div class="line">  }</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (std::abs(cell-&gt;face(face)-&gt;center()[0] - parameters.width/2.0) &lt; tol)</div><div class="line">  {</div><div class="line">    cell-&gt;face(face)-&gt;set_boundary_id(parameters.boundary_id_plus_X);</div><div class="line">  }</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (std::abs(cell-&gt;face(face)-&gt;center()[1] - 0.0) &lt; tol)</div><div class="line">  {</div><div class="line">    cell-&gt;face(face)-&gt;set_boundary_id(parameters.boundary_id_minus_Y);</div><div class="line">  }</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (std::abs(cell-&gt;face(face)-&gt;center()[1] - parameters.length/2.0) &lt; tol)</div><div class="line">  {</div><div class="line">    cell-&gt;face(face)-&gt;set_boundary_id(parameters.boundary_id_plus_Y);</div><div class="line">  }</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (std::abs(cell-&gt;face(face)-&gt;center()[2] - 0.0) &lt; tol)</div><div class="line">  {</div><div class="line">    cell-&gt;face(face)-&gt;set_boundary_id(parameters.boundary_id_minus_Z);</div><div class="line">  }</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (std::abs(cell-&gt;face(face)-&gt;center()[2] - parameters.thickness/2.0) &lt; tol)</div><div class="line">  {</div><div class="line">    cell-&gt;face(face)-&gt;set_boundary_id(parameters.boundary_id_plus_Z);</div><div class="line">  }</div><div class="line"><span class="keywordflow">else</span></div><div class="line">  {</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertex=0; vertex&lt;GeometryInfo&lt;dim&gt;::vertices_per_face; ++vertex)</div><div class="line">      {</div></div><!-- fragment --><p>Project the cell vertex to the XY plane and test the distance from the cylinder axis</p>
<div class="fragment"><div class="line">      <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> vertex_proj = cell-&gt;vertex(vertex);</div><div class="line">      vertex_proj[2] = 0.0;</div><div class="line">      <span class="keywordflow">if</span> (std::abs(vertex_proj.<a class="code" href="classPoint.html#a3df8e6ab311dab9337c8d7b039c7b815">distance</a>(centre) - parameters.hole_diameter/2.0) &lt; tol)</div><div class="line">        {</div><div class="line">          cell-&gt;face(face)-&gt;set_boundary_id(parameters.boundary_id_hole);</div><div class="line">          <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>Set manifold IDs</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertex=0; vertex&lt;GeometryInfo&lt;dim&gt;::vertices_per_face; ++vertex)</div><div class="line">  {</div></div><!-- fragment --><p>Project the cell vertex to the XY plane and test the distance from the cylinder axis</p>
<div class="fragment"><div class="line"><a class="code" href="classPoint.html">Point&lt;dim&gt;</a> vertex_proj = cell-&gt;vertex(vertex);</div><div class="line">vertex_proj[2] = 0.0;</div><div class="line"><span class="keywordflow">if</span> (std::abs(vertex_proj.<a class="code" href="classPoint.html#a3df8e6ab311dab9337c8d7b039c7b815">distance</a>(centre) - parameters.hole_diameter/2.0) &lt; 1e-12)</div><div class="line">  {</div></div><!-- fragment --><p>Set manifold ID on face and edges</p>
<div class="fragment"><div class="line">                    cell-&gt;face(face)-&gt;set_all_manifold_ids(parameters.manifold_id_hole);</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line">                  }</div><div class="line">              }</div><div class="line">          }</div><div class="line">    }</div><div class="line">  <span class="keyword">static</span> <a class="code" href="classCylindricalManifold.html">CylindricalManifold&lt;dim&gt;</a> cylindrical_manifold (direction,centre);</div><div class="line">  triangulation.<a class="code" href="group__manifold.html#ga9f9d720f5fbdcdf3dcbb445feefbdb9f">set_manifold</a>(parameters.manifold_id_hole,cylindrical_manifold);</div><div class="line">  triangulation.<a class="code" href="classTriangulation.html#a6ad0b3fb24aae17f4668427a433dea19">refine_global</a>(parameters.global_refinement);</div><div class="line">  <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">GridTools::scale</a>(parameters.scale,triangulation);</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::make_2d_quarter_plate_with_hole(<a class="code" href="classTriangulation.html">Triangulation&lt;2&gt;</a> &amp;tria_2d,</div><div class="line">                                                 <span class="keyword">const</span> <span class="keywordtype">double</span> half_length,</div><div class="line">                                                 <span class="keyword">const</span> <span class="keywordtype">double</span> half_width,</div><div class="line">                                                 <span class="keyword">const</span> <span class="keywordtype">double</span> hole_radius,</div><div class="line">                                                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_repetitions_xy,</div><div class="line">                                                 <span class="keyword">const</span> <span class="keywordtype">double</span> hole_division_fraction)</div><div class="line">{</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> length = 2.0*half_length;</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> width = 2.0*half_width;</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> hole_diameter = 2.0*hole_radius;</div><div class="line"></div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> internal_width = hole_diameter + hole_division_fraction*(width - hole_diameter);</div><div class="line">  <a class="code" href="classTriangulation.html">Triangulation&lt;2&gt;</a> tria_quarter_plate_hole;</div><div class="line">  {</div><div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;2&gt;</a> tria_plate_hole;</div><div class="line">    <a class="code" href="namespaceGridGenerator.html#add14cab546d033c1eaacc9234c64ebcd">GridGenerator::hyper_cube_with_cylindrical_hole</a> (tria_plate_hole,</div><div class="line">                                                     hole_diameter/2.0,</div><div class="line">                                                     internal_width/2.0);</div><div class="line"></div><div class="line">    std::set&lt;typename Triangulation&lt;2&gt;::active_cell_iterator &gt; cells_to_remove;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">typename</span> <a class="code" href="classTriaActiveIterator.html">Triangulation&lt;2&gt;::active_cell_iterator</a></div><div class="line">         cell = tria_plate_hole.<a class="code" href="classTriangulation.html#a9388e821c728eab8d0e699d0ca112482">begin_active</a>();</div><div class="line">         cell != tria_plate_hole.<a class="code" href="classTriangulation.html#afdbd22694fb7591e822577a8f8a90de9">end</a>(); ++cell)</div><div class="line">      {</div></div><!-- fragment --><p>Remove all cells that are not in the first quadrant</p>
<div class="fragment"><div class="line">      <span class="keywordflow">if</span> (cell-&gt;center()[0] &lt; 0.0 || cell-&gt;center()[1] &lt; 0.0)</div><div class="line">        cells_to_remove.insert(cell);</div><div class="line">    }</div><div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cells_to_remove.size() &gt; 0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cells_to_remove.size() != tria_plate_hole.<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>(), <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">  <a class="code" href="namespaceGridGenerator.html#ada140ece81bf38a23e738e0e57f89e97">GridGenerator::create_triangulation_with_removed_cells</a>(tria_plate_hole,cells_to_remove,tria_quarter_plate_hole);</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="classTriangulation.html">Triangulation&lt;2&gt;</a> tria_cut_plate;</div><div class="line">{</div><div class="line">  <a class="code" href="classTriangulation.html">Triangulation&lt;2&gt;</a> tria_plate;</div></div><!-- fragment --><p>Subdivide the plate so that we're left one cell to remove (we'll replace this with the plate with the hole) and then make the rest of the subdivisions so that we're left with cells with a decent aspect ratio</p>
<div class="fragment"><div class="line">std::vector&lt;std::vector&lt;double&gt; &gt; step_sizes;</div><div class="line">{</div><div class="line">  std::vector&lt;double&gt; subdivision_width;</div><div class="line">  subdivision_width.push_back(internal_width/2.0);</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> width_remaining = (width - internal_width)/2.0;</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_subs = std::max(1.0,std::ceil(width_remaining/(internal_width/2.0)));</div><div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(n_subs&gt;0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> s=0; s&lt;n_subs; ++s)</div><div class="line">    subdivision_width.push_back(width_remaining/n_subs);</div><div class="line">  step_sizes.push_back(subdivision_width);</div><div class="line"></div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> sum_half_width = std::accumulate(subdivision_width.begin(), subdivision_width.end(), 0.0);</div><div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(std::abs(sum_half_width-width/2.0) &lt; 1e-12, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">}</div><div class="line">{</div><div class="line">  std::vector&lt;double&gt; subdivision_length;</div><div class="line">  subdivision_length.push_back(internal_width/2.0);</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> length_remaining = (length - internal_width)/2.0;</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_subs = std::max(1.0,std::ceil(length_remaining/(internal_width/2.0)));</div><div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(n_subs&gt;0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> s=0; s&lt;n_subs; ++s)</div><div class="line">    subdivision_length.push_back(length_remaining/n_subs);</div><div class="line">  step_sizes.push_back(subdivision_length);</div><div class="line"></div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> sum_half_length = std::accumulate(subdivision_length.begin(), subdivision_length.end(), 0.0);</div><div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(std::abs(sum_half_length-length/2.0) &lt; 1e-12, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="namespaceGridGenerator.html#ac76417d7404b75cf53c732f456e6e971">GridGenerator::subdivided_hyper_rectangle</a>(tria_plate,</div><div class="line">                                          step_sizes,</div><div class="line">                                          <a class="code" href="classPoint.html">Point&lt;2&gt;</a>(0.0, 0.0),</div><div class="line">                                          <a class="code" href="classPoint.html">Point&lt;2&gt;</a>(width/2.0, length/2.0));</div><div class="line"></div><div class="line">std::set&lt;typename Triangulation&lt;2&gt;::active_cell_iterator &gt; cells_to_remove;</div><div class="line"><span class="keywordflow">for</span> (<span class="keyword">typename</span> <a class="code" href="classTriaActiveIterator.html">Triangulation&lt;2&gt;::active_cell_iterator</a></div><div class="line">     cell = tria_plate.<a class="code" href="classTriangulation.html#a9388e821c728eab8d0e699d0ca112482">begin_active</a>();</div><div class="line">     cell != tria_plate.<a class="code" href="classTriangulation.html#afdbd22694fb7591e822577a8f8a90de9">end</a>(); ++cell)</div><div class="line">  {</div></div><!-- fragment --><p>Remove all cells that are in the first quadrant</p>
<div class="fragment"><div class="line">      <span class="keywordflow">if</span> (cell-&gt;center()[0] &lt; internal_width/2.0 &amp;&amp; cell-&gt;center()[1] &lt; internal_width/2.0)</div><div class="line">        cells_to_remove.insert(cell);</div><div class="line">    }</div><div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cells_to_remove.size() &gt; 0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cells_to_remove.size() != tria_plate.<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>(), <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">  <a class="code" href="namespaceGridGenerator.html#ada140ece81bf38a23e738e0e57f89e97">GridGenerator::create_triangulation_with_removed_cells</a>(tria_plate,cells_to_remove,tria_cut_plate);</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="classTriangulation.html">Triangulation&lt;2&gt;</a> tria_2d_not_flat;</div><div class="line"><a class="code" href="namespaceGridGenerator.html#a0dace8884c1510160d7b6cbb313523e9">GridGenerator::merge_triangulations</a>(tria_quarter_plate_hole,</div><div class="line">                                    tria_cut_plate,</div><div class="line">                                    tria_2d_not_flat);</div></div><!-- fragment --><p>Attach a manifold to the curved boundary and refine Note: We can only guarentee that the vertices sit on the curve, so we must test with their position instead of the cell centre.</p>
<div class="fragment"><div class="line">  <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;2&gt;</a> centre_2d (0,0);</div><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">typename</span> <a class="code" href="classTriaActiveIterator.html">Triangulation&lt;2&gt;::active_cell_iterator</a></div><div class="line">       cell = tria_2d_not_flat.<a class="code" href="classTriangulation.html#a9388e821c728eab8d0e699d0ca112482">begin_active</a>();</div><div class="line">       cell != tria_2d_not_flat.<a class="code" href="classTriangulation.html#afdbd22694fb7591e822577a8f8a90de9">end</a>(); ++cell)</div><div class="line">    {</div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> face=0; face&lt;GeometryInfo&lt;2&gt;::faces_per_cell; ++face)</div><div class="line">        <span class="keywordflow">if</span> (cell-&gt;face(face)-&gt;at_boundary())</div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertex=0; vertex&lt;GeometryInfo&lt;2&gt;::vertices_per_face; ++vertex)</div><div class="line">            <span class="keywordflow">if</span> (std::abs(cell-&gt;vertex(vertex).distance(centre_2d) - hole_diameter/2.0) &lt; 1e-12)</div><div class="line">              {</div><div class="line">                cell-&gt;face(face)-&gt;set_manifold_id(10);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">              }</div><div class="line">    }</div><div class="line">  <a class="code" href="classSphericalManifold.html">SphericalManifold&lt;2&gt;</a> spherical_manifold_2d (centre_2d);</div><div class="line">  tria_2d_not_flat.<a class="code" href="group__manifold.html#ga9f9d720f5fbdcdf3dcbb445feefbdb9f">set_manifold</a>(10,spherical_manifold_2d);</div><div class="line">  tria_2d_not_flat.<a class="code" href="classTriangulation.html#a6ad0b3fb24aae17f4668427a433dea19">refine_global</a>(std::max (1U, n_repetitions_xy));</div><div class="line">  tria_2d_not_flat.<a class="code" href="group__manifold.html#ga9f9d720f5fbdcdf3dcbb445feefbdb9f">set_manifold</a>(10); <span class="comment">// Clear manifold</span></div><div class="line"></div><div class="line">  <a class="code" href="namespaceGridGenerator.html#afe86bf1a4502131ec811a6de41ab41e9">GridGenerator::flatten_triangulation</a>(tria_2d_not_flat,tria_2d);</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::setup_system(LA::MPI::BlockVector &amp;solution_delta)</div><div class="line">{</div><div class="line">  timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Setup system&quot;</span>);</div><div class="line">  pcout &lt;&lt; <span class="stringliteral">&quot;Setting up linear system...&quot;</span> &lt;&lt; std::endl;</div></div><!-- fragment --><p>Partition triangulation</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceGridTools.html#a5b4706b77042db5437cf81fd13e62b20">GridTools::partition_triangulation</a> (n_mpi_processes,</div><div class="line">                                    triangulation);</div><div class="line"></div><div class="line">block_component = std::vector&lt;unsigned int&gt; (<a class="code" href="classDoFHandler.html#ac69f2dc12d3d013e11f7bfd70e328dcb">n_components</a>, u_block); <span class="comment">// Displacement</span></div><div class="line">block_component[p_component] = p_block; <span class="comment">// Pressure</span></div><div class="line">block_component[J_component] = J_block; <span class="comment">// Dilatation</span></div><div class="line">dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(fe);</div><div class="line"><a class="code" href="namespaceDoFRenumbering.html#ab938a690bf4e2adff191fe969b0f21d3">DoFRenumbering::Cuthill_McKee</a>(dof_handler);</div><div class="line"><a class="code" href="namespaceDoFRenumbering.html#a52c1941406d1ce2937e29a46edf111f4">DoFRenumbering::component_wise</a>(dof_handler, block_component);</div></div><!-- fragment --><p>Count DoFs in each block</p>
<div class="fragment"><div class="line">dofs_per_block.clear();</div><div class="line">dofs_per_block.resize(n_blocks);</div><div class="line"><a class="code" href="namespaceDoFTools.html#abfd9796e22113e13b5802e384e56af4f">DoFTools::count_dofs_per_block</a>(dof_handler, dofs_per_block,</div><div class="line">                               block_component);</div><div class="line"></div><div class="line">all_locally_owned_dofs = <a class="code" href="namespaceDoFTools.html#a6985533ce0fbf92a5a2027191e90c90b">DoFTools::locally_owned_dofs_per_subdomain</a> (dof_handler);</div><div class="line">std::vector&lt;IndexSet&gt; all_locally_relevant_dofs</div><div class="line">  = <a class="code" href="namespaceDoFTools.html#adae1aeea4bbbeb60d0e75874b90dd6a9">DoFTools::locally_relevant_dofs_per_subdomain</a> (dof_handler);</div><div class="line"></div><div class="line">locally_owned_dofs.<a class="code" href="classIndexSet.html#a8a3d75a9cba3f1a50866691327aa7609">clear</a>();</div><div class="line">locally_owned_partitioning.clear();</div><div class="line"><a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(all_locally_owned_dofs.size() &gt; this_mpi_process, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">locally_owned_dofs = all_locally_owned_dofs[this_mpi_process];</div><div class="line"></div><div class="line">locally_relevant_dofs.<a class="code" href="classIndexSet.html#a8a3d75a9cba3f1a50866691327aa7609">clear</a>();</div><div class="line">locally_relevant_partitioning.clear();</div><div class="line"><a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(all_locally_relevant_dofs.size() &gt; this_mpi_process, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">locally_relevant_dofs = all_locally_relevant_dofs[this_mpi_process];</div><div class="line"></div><div class="line">locally_owned_partitioning.reserve(n_blocks);</div><div class="line">locally_relevant_partitioning.reserve(n_blocks);</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> b=0; b&lt;n_blocks; ++b)</div><div class="line">  {</div><div class="line">    <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a3bf9e493f1aab00b04933b81856144c4">types::global_dof_index</a> idx_begin</div><div class="line">      = std::accumulate(dofs_per_block.begin(),</div><div class="line">                        std::next(dofs_per_block.begin(),b), 0);</div><div class="line">    <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a3bf9e493f1aab00b04933b81856144c4">types::global_dof_index</a> idx_end</div><div class="line">      = std::accumulate(dofs_per_block.begin(),</div><div class="line">                        std::next(dofs_per_block.begin(),b+1), 0);</div><div class="line">    locally_owned_partitioning.push_back(locally_owned_dofs.get_view(idx_begin, idx_end));</div><div class="line">    locally_relevant_partitioning.push_back(locally_relevant_dofs.get_view(idx_begin, idx_end));</div><div class="line">  }</div><div class="line"></div><div class="line">pcout</div><div class="line">    &lt;&lt; <span class="stringliteral">&quot;  Number of active cells: &quot;</span> &lt;&lt; triangulation.<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>()</div><div class="line">    &lt;&lt; <span class="stringliteral">&quot; (by partition:&quot;</span>;</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p=0; p&lt;n_mpi_processes; ++p)</div><div class="line">  pcout</div><div class="line">      &lt;&lt; (p==0 ? <span class="charliteral">&#39; &#39;</span> : <span class="charliteral">&#39;+&#39;</span>)</div><div class="line">      &lt;&lt; (<a class="code" href="namespaceGridTools.html#a8c212a30784bec20b1ae13fad3fd579c">GridTools::count_cells_with_subdomain_association</a> (triangulation,p));</div><div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div><div class="line"></div><div class="line">pcout</div><div class="line">    &lt;&lt; <span class="stringliteral">&quot;  Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>()</div><div class="line">    &lt;&lt; <span class="stringliteral">&quot; (by partition:&quot;</span>;</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p=0; p&lt;n_mpi_processes; ++p)</div><div class="line">  pcout</div><div class="line">      &lt;&lt; (p==0 ? <span class="charliteral">&#39; &#39;</span> : <span class="charliteral">&#39;+&#39;</span>)</div><div class="line">      &lt;&lt; (<a class="code" href="namespaceDoFTools.html#a2dde9ded6d7cbc9962547356f37e5f72">DoFTools::count_dofs_with_subdomain_association</a> (dof_handler,p));</div><div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div><div class="line">pcout</div><div class="line">    &lt;&lt; <span class="stringliteral">&quot;  Number of degrees of freedom per block: &quot;</span></div><div class="line">    &lt;&lt; <span class="stringliteral">&quot;[n_u, n_p, n_J] = [&quot;</span></div><div class="line">    &lt;&lt; dofs_per_block[u_block] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div><div class="line">    &lt;&lt; dofs_per_block[p_block] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div><div class="line">    &lt;&lt; dofs_per_block[J_block] &lt;&lt; <span class="stringliteral">&quot;]&quot;</span></div><div class="line">    &lt;&lt; std::endl;</div><div class="line"></div><div class="line"></div><div class="line"><a class="code" href="classTable.html">Table&lt;2, DoFTools::Coupling&gt;</a> coupling(n_components, n_components);</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ii = 0; ii &lt; <a class="code" href="classDoFHandler.html#ac69f2dc12d3d013e11f7bfd70e328dcb">n_components</a>; ++ii)</div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> jj = 0; jj &lt; <a class="code" href="classDoFHandler.html#ac69f2dc12d3d013e11f7bfd70e328dcb">n_components</a>; ++jj)</div><div class="line">    <span class="keywordflow">if</span> (((ii &lt; p_component) &amp;&amp; (jj == J_component))</div><div class="line">        || ((ii == J_component) &amp;&amp; (jj &lt; p_component))</div><div class="line">        || ((ii == p_component) &amp;&amp; (jj == p_component)))</div><div class="line">      coupling[ii][jj] = <a class="code" href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a193fa079dee88a75524f669136d6faba">DoFTools::none</a>;</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">      coupling[ii][jj] = <a class="code" href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a6a742e14fbc92a1c202d77d4f319d5ec">DoFTools::always</a>;</div><div class="line"></div><div class="line"><a class="code" href="classTrilinosWrappers_1_1BlockSparsityPattern.html">TrilinosWrappers::BlockSparsityPattern</a> bsp (locally_owned_partitioning,</div><div class="line">                                            locally_owned_partitioning,</div><div class="line">                                            locally_relevant_partitioning,</div><div class="line">                                            mpi_communicator);</div><div class="line"><a class="code" href="group__constraints.html#ga38d88a1a559e9fc65d60f3e168921ba5">DoFTools::make_sparsity_pattern</a> (dof_handler, bsp,</div><div class="line">                                 constraints, <span class="keyword">false</span>,</div><div class="line">                                 this_mpi_process);</div><div class="line">bsp.compress();</div><div class="line">tangent_matrix.reinit (bsp);</div></div><!-- fragment --><p>We then set up storage vectors</p>
<div class="fragment"><div class="line">  system_rhs.reinit(locally_owned_partitioning,</div><div class="line">                    mpi_communicator);</div><div class="line">  solution_n.reinit(locally_owned_partitioning,</div><div class="line">                    mpi_communicator);</div><div class="line">  solution_delta.reinit(locally_owned_partitioning,</div><div class="line">                        mpi_communicator);</div><div class="line">  setup_qph();</div><div class="line">  timer.<a class="code" href="classTimerOutput.html#a220e755259be51f43eaa547c24b08080">leave_subsection</a>();</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span></div><div class="line">Solid&lt;dim&gt;::determine_component_extractors()</div><div class="line">{</div><div class="line">  element_indices_u.clear();</div><div class="line">  element_indices_p.clear();</div><div class="line">  element_indices_J.clear();</div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; fe.<a class="code" href="classFiniteElementData.html#ae2fa3b8d578ba488b4f37061bb0278bb">dofs_per_cell</a>; ++k)</div><div class="line">    {</div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k_group = fe.<a class="code" href="classFiniteElement.html#a95ac75dfc5b9f4e01c34d5865b4ca5a2">system_to_base_index</a>(k).first.first;</div><div class="line">      <span class="keywordflow">if</span> (k_group == u_block)</div><div class="line">        element_indices_u.push_back(k);</div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == p_block)</div><div class="line">        element_indices_p.push_back(k);</div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == J_block)</div><div class="line">        element_indices_J.push_back(k);</div><div class="line">      <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(k_group &lt;= J_block, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::setup_qph()</div><div class="line">{</div><div class="line">  pcout &lt;&lt; <span class="stringliteral">&quot;Setting up quadrature point data...&quot;</span> &lt;&lt; std::endl;</div><div class="line">  quadrature_point_history.<a class="code" href="classCellDataStorage.html#a9ce38927ac1a1f96618c2624da89d65b">initialize</a>(triangulation.<a class="code" href="classTriangulation.html#a9388e821c728eab8d0e699d0ca112482">begin_active</a>(),</div><div class="line">                                      triangulation.<a class="code" href="classTriangulation.html#afdbd22694fb7591e822577a8f8a90de9">end</a>(),</div><div class="line">                                      n_q_points);</div><div class="line">  <a class="code" href="classFilteredIterator.html">FilteredIterator&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator</a>&gt;</div><div class="line">  cell (<a class="code" href="classIteratorFilters_1_1SubdomainEqualTo.html">IteratorFilters::SubdomainEqualTo</a>(this_mpi_process),</div><div class="line">        dof_handler.<a class="code" href="classDoFHandler.html#a1a36dbbb4c54a7038c60ee9c8eab369a">begin_active</a>()),</div><div class="line">                                 endc (<a class="code" href="classIteratorFilters_1_1SubdomainEqualTo.html">IteratorFilters::SubdomainEqualTo</a>(this_mpi_process),</div><div class="line">                                       dof_handler.<a class="code" href="classDoFHandler.html#a7b510a66ee9ea25720f64220496126ec">end</a>());</div><div class="line">  <span class="keywordflow">for</span> (; cell!=endc; ++cell)</div><div class="line">    {</div><div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cell-&gt;subdomain_id()==this_mpi_process, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">      <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;PointHistory&lt;dim&gt; &gt; &gt; lqph =</div><div class="line">        quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div><div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div><div class="line">        lqph[q_point]-&gt;setup_lqp(parameters, time);</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span></div><div class="line">Solid&lt;dim&gt;::solve_nonlinear_timestep(LA::MPI::BlockVector &amp;solution_delta)</div><div class="line">{</div><div class="line">  pcout &lt;&lt; std::endl</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;Timestep &quot;</span> &lt;&lt; time.get_timestep() &lt;&lt; <span class="stringliteral">&quot; @ &quot;</span></div><div class="line">        &lt;&lt; time.current() &lt;&lt; <span class="stringliteral">&quot;s of &quot;</span></div><div class="line">        &lt;&lt; time.end() &lt;&lt; <span class="stringliteral">&quot;s&quot;</span> &lt;&lt; std::endl;</div><div class="line">  LA::MPI::BlockVector newton_update(locally_owned_partitioning,</div><div class="line">                                     mpi_communicator);</div><div class="line">  error_residual.reset();</div><div class="line">  error_residual_0.reset();</div><div class="line">  error_residual_norm.reset();</div><div class="line">  error_update.reset();</div><div class="line">  error_update_0.reset();</div><div class="line">  error_update_norm.reset();</div><div class="line">  print_conv_header();</div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newton_iteration = 0;</div><div class="line">  <span class="keywordflow">for</span> (; newton_iteration &lt; parameters.max_iterations_NR;</div><div class="line">       ++newton_iteration)</div><div class="line">    {</div><div class="line">      pcout &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::setw(2) &lt;&lt; newton_iteration &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::flush;</div><div class="line">      make_constraints(newton_iteration);</div><div class="line">      assemble_system(solution_delta);</div><div class="line">      get_error_residual(error_residual);</div><div class="line">      <span class="keywordflow">if</span> (newton_iteration == 0)</div><div class="line">        error_residual_0 = error_residual;</div><div class="line">      error_residual_norm = error_residual;</div><div class="line">      error_residual_norm.normalise(error_residual_0);</div><div class="line">      <span class="keywordflow">if</span> (newton_iteration &gt; 0 &amp;&amp;</div><div class="line">          (error_update_norm.u &lt;= parameters.tol_u &amp;&amp;</div><div class="line">           error_residual_norm.u &lt;= parameters.tol_f) )</div><div class="line">        {</div><div class="line">          pcout &lt;&lt; <span class="stringliteral">&quot; CONVERGED! &quot;</span> &lt;&lt; std::endl;</div><div class="line">          print_conv_footer(solution_delta);</div><div class="line">          <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">      <span class="keyword">const</span> std::pair&lt;unsigned int, double&gt;</div><div class="line">      lin_solver_output = solve_linear_system(newton_update);</div><div class="line">      get_error_update(newton_update, error_update);</div><div class="line">      <span class="keywordflow">if</span> (newton_iteration == 0)</div><div class="line">        error_update_0 = error_update;</div><div class="line">      error_update_norm = error_update;</div><div class="line">      error_update_norm.normalise(error_update_0);</div><div class="line">      solution_delta += newton_update;</div><div class="line">      newton_update = 0.0;</div><div class="line">      pcout &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; std::fixed &lt;&lt; std::setprecision(3) &lt;&lt; std::setw(7)</div><div class="line">            &lt;&lt; std::scientific &lt;&lt; lin_solver_output.first &lt;&lt; <span class="stringliteral">&quot;  &quot;</span></div><div class="line">            &lt;&lt; lin_solver_output.second &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_residual_norm.norm</div><div class="line">            &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_residual_norm.u &lt;&lt; <span class="stringliteral">&quot;  &quot;</span></div><div class="line">            &lt;&lt; error_residual_norm.p &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_residual_norm.J</div><div class="line">            &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.norm &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.u</div><div class="line">            &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.p &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.J</div><div class="line">            &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line">  <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a> (newton_iteration &lt;= parameters.max_iterations_NR,</div><div class="line">               <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;No convergence in nonlinear solver!&quot;</span>));</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::print_conv_header()</div><div class="line">{</div><div class="line">  pcout &lt;&lt; std::string(132,<span class="charliteral">&#39;_&#39;</span>) &lt;&lt; std::endl;</div><div class="line">  pcout &lt;&lt; <span class="stringliteral">&quot;     SOLVER STEP       &quot;</span></div><div class="line">        &lt;&lt; <span class="stringliteral">&quot; |  LIN_IT   LIN_RES    RES_NORM    &quot;</span></div><div class="line">        &lt;&lt; <span class="stringliteral">&quot; RES_U     RES_P      RES_J     NU_NORM     &quot;</span></div><div class="line">        &lt;&lt; <span class="stringliteral">&quot; NU_U       NU_P       NU_J &quot;</span> &lt;&lt; std::endl;</div><div class="line">  pcout &lt;&lt; std::string(132,<span class="charliteral">&#39;_&#39;</span>) &lt;&lt; std::endl;</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::print_conv_footer(<span class="keyword">const</span> LA::MPI::BlockVector &amp;solution_delta)</div><div class="line">{</div><div class="line">  pcout &lt;&lt; std::string(132,<span class="charliteral">&#39;_&#39;</span>) &lt;&lt; std::endl;</div><div class="line">  <span class="keyword">const</span> std::pair&lt;double,std::pair&lt;double,double&gt; &gt; error_dil = get_error_dilation(get_solution_total(solution_delta));</div><div class="line">  pcout &lt;&lt; <span class="stringliteral">&quot;Relative errors:&quot;</span> &lt;&lt; std::endl</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;Displacement:\t&quot;</span> &lt;&lt; error_update.u / error_update_0.u &lt;&lt; std::endl</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;Force: \t\t&quot;</span> &lt;&lt; error_residual.u / error_residual_0.u &lt;&lt; std::endl</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;Dilatation:\t&quot;</span> &lt;&lt; error_dil.first &lt;&lt; std::endl</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;v / V_0:\t&quot;</span> &lt;&lt; error_dil.second.second &lt;&lt; <span class="stringliteral">&quot; / &quot;</span> &lt;&lt; error_dil.second.first</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; (error_dil.second.second/error_dil.second.first) &lt;&lt; std::endl;</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line">std::pair&lt;double,std::pair&lt;double,double&gt; &gt;</div><div class="line">Solid&lt;dim&gt;::get_error_dilation(<span class="keyword">const</span> LA::MPI::BlockVector &amp;solution_total)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">  <span class="keywordtype">double</span> vol_reference = 0.0;</div><div class="line">  <span class="keywordtype">double</span> vol_current = 0.0;</div><div class="line">  <span class="keywordtype">double</span> dil_L2_error = 0.0;</div><div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values_ref(fe, qf_cell,</div><div class="line">                              <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div><div class="line">  std::vector&lt;Tensor&lt;2, dim&gt; &gt; solution_grads_u_total (qf_cell.<a class="code" href="classQuadrature.html#af9f7d82770fa8126e19113f3e3db755b">size</a>());</div><div class="line">  std::vector&lt;double&gt;          solution_values_J_total (qf_cell.<a class="code" href="classQuadrature.html#af9f7d82770fa8126e19113f3e3db755b">size</a>());</div><div class="line">  <a class="code" href="classFilteredIterator.html">FilteredIterator&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator</a>&gt;</div><div class="line">  cell (<a class="code" href="classIteratorFilters_1_1SubdomainEqualTo.html">IteratorFilters::SubdomainEqualTo</a>(this_mpi_process),</div><div class="line">        dof_handler.<a class="code" href="classDoFHandler.html#a1a36dbbb4c54a7038c60ee9c8eab369a">begin_active</a>()),</div><div class="line">                                 endc (<a class="code" href="classIteratorFilters_1_1SubdomainEqualTo.html">IteratorFilters::SubdomainEqualTo</a>(this_mpi_process),</div><div class="line">                                       dof_handler.<a class="code" href="classDoFHandler.html#a7b510a66ee9ea25720f64220496126ec">end</a>());</div><div class="line">  <span class="keywordflow">for</span> (; cell != endc; ++cell)</div><div class="line">    {</div><div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cell-&gt;subdomain_id()==this_mpi_process, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">      fe_values_ref.<a class="code" href="classFEValues.html#aec8f5b8b3e4c5dcf35dfd029a1ecbbd0">reinit</a>(cell);</div><div class="line">      fe_values_ref[u_fe].<a class="code" href="classFEValuesBase.html#aab06de0a7599e39bd417cdc8d5732362">get_function_gradients</a>(solution_total,</div><div class="line">                                                 solution_grads_u_total);</div><div class="line">      fe_values_ref[J_fe].<a class="code" href="classFEValuesBase.html#a357b422e374f2f2207af3512093f3907">get_function_values</a>(solution_total,</div><div class="line">                                              solution_values_J_total);</div><div class="line">      <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const PointHistory&lt;dim&gt; &gt; &gt; lqph =</div><div class="line">        quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div><div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div><div class="line">        {</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> det_F_qp = <a class="code" href="classSymmetricTensor.html#a31d48ca1d251a7a32db8b673e6010193">determinant</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">Physics::Elasticity::Kinematics::F</a>(solution_grads_u_total[q_point]));</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> J_tilde_qp = solution_values_J_total[q_point];</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> the_error_qp_squared = std::pow((det_F_qp - J_tilde_qp),</div><div class="line">                                                       2);</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> JxW = fe_values_ref.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(q_point);</div><div class="line">          dil_L2_error  += the_error_qp_squared * JxW;</div><div class="line">          vol_reference += JxW;</div><div class="line">          vol_current   += det_F_qp * JxW;</div><div class="line">        }</div><div class="line">    }</div><div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(vol_current &gt; 0.0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div></div><!-- fragment --><p>Sum across all porcessors</p>
<div class="fragment"><div class="line">  dil_L2_error  = <a class="code" href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">Utilities::MPI::sum</a>(dil_L2_error,mpi_communicator);</div><div class="line">  vol_reference = <a class="code" href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">Utilities::MPI::sum</a>(vol_reference,mpi_communicator);</div><div class="line">  vol_current   = <a class="code" href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">Utilities::MPI::sum</a>(vol_current,mpi_communicator);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> std::make_pair(std::sqrt(dil_L2_error),</div><div class="line">                        std::make_pair(vol_reference,vol_current));</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::get_error_residual(Errors &amp;error_residual)</div><div class="line">{</div></div><!-- fragment --><p>Construct a residual vector that has the values for all of its constrained DoFs set to zero.</p>
<div class="fragment"><div class="line">  LA::MPI::BlockVector error_res (system_rhs);</div><div class="line">  constraints.<a class="code" href="classConstraintMatrix.html#a5a4f1186dc10d707b933b6ff24f7cad8">set_zero</a>(error_res);</div><div class="line">  error_residual.norm = error_res.l2_norm();</div><div class="line">  error_residual.u = error_res.block(u_block).l2_norm();</div><div class="line">  error_residual.p = error_res.block(p_block).l2_norm();</div><div class="line">  error_residual.J = error_res.block(J_block).l2_norm();</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::get_error_update(<span class="keyword">const</span> LA::MPI::BlockVector &amp;newton_update,</div><div class="line">                                  Errors &amp;error_update)</div><div class="line">{</div></div><!-- fragment --><p>Construct a update vector that has the values for all of its constrained DoFs set to zero.</p>
<div class="fragment"><div class="line">  LA::MPI::BlockVector error_ud (newton_update);</div><div class="line">  constraints.<a class="code" href="classConstraintMatrix.html#a5a4f1186dc10d707b933b6ff24f7cad8">set_zero</a>(error_ud);</div><div class="line">  error_update.norm = error_ud.l2_norm();</div><div class="line">  error_update.u = error_ud.block(u_block).l2_norm();</div><div class="line">  error_update.p = error_ud.block(p_block).l2_norm();</div><div class="line">  error_update.J = error_ud.block(J_block).l2_norm();</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line">LA::MPI::BlockVector</div><div class="line">Solid&lt;dim&gt;::get_solution_total(<span class="keyword">const</span> LA::MPI::BlockVector &amp;solution_delta)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div></div><!-- fragment --><p>Cell interpolation -&gt; Ghosted vector</p>
<div class="fragment"><div class="line">  LA::MPI::BlockVector solution_total (locally_owned_partitioning,</div><div class="line">                                       locally_relevant_partitioning,</div><div class="line">                                       mpi_communicator,</div><div class="line">                                       / *vector_writable = * / <span class="keyword">false</span>);</div><div class="line">  LA::MPI::BlockVector tmp (solution_total);</div><div class="line">  solution_total = solution_n;</div><div class="line">  tmp = solution_delta;</div><div class="line">  solution_total += tmp;</div><div class="line">  <span class="keywordflow">return</span> solution_total;</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_system(<span class="keyword">const</span> LA::MPI::BlockVector &amp;solution_delta)</div><div class="line">{</div><div class="line">  timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Assemble system&quot;</span>);</div><div class="line">  pcout &lt;&lt; <span class="stringliteral">&quot; ASM_SYS &quot;</span> &lt;&lt; std::flush;</div><div class="line">  tangent_matrix = 0.0;</div><div class="line">  system_rhs = 0.0;</div><div class="line">  <span class="keyword">const</span> LA::MPI::BlockVector solution_total(get_solution_total(solution_delta));</div><div class="line">  <span class="keyword">const</span> <a class="code" href="group__feaccess.html#gaa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_cell(<a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> |</div><div class="line">                            <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div><div class="line">                            <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div><div class="line">  <span class="keyword">const</span> <a class="code" href="group__feaccess.html#gaa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_face(<a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> |</div><div class="line">                            <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a> |</div><div class="line">                            <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div><div class="line">  PerTaskData_ASM per_task_data(dofs_per_cell);</div><div class="line">  ScratchData_ASM scratch_data(fe, qf_cell, uf_cell, qf_face, uf_face, solution_total);</div><div class="line"></div><div class="line">  <a class="code" href="classFilteredIterator.html">FilteredIterator&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator</a>&gt;</div><div class="line">  cell (<a class="code" href="classIteratorFilters_1_1SubdomainEqualTo.html">IteratorFilters::SubdomainEqualTo</a>(this_mpi_process),</div><div class="line">        dof_handler.<a class="code" href="classDoFHandler.html#a1a36dbbb4c54a7038c60ee9c8eab369a">begin_active</a>()),</div><div class="line">                                 endc (<a class="code" href="classIteratorFilters_1_1SubdomainEqualTo.html">IteratorFilters::SubdomainEqualTo</a>(this_mpi_process),</div><div class="line">                                       dof_handler.<a class="code" href="classDoFHandler.html#a7b510a66ee9ea25720f64220496126ec">end</a>());</div><div class="line">  <span class="keywordflow">for</span> (; cell != endc; ++cell)</div><div class="line">    {</div><div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cell-&gt;subdomain_id()==this_mpi_process, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">      assemble_system_one_cell(cell, scratch_data, per_task_data);</div><div class="line">      copy_local_to_global_system(per_task_data);</div><div class="line">    }</div><div class="line">  tangent_matrix.compress(<a class="code" href="structVectorOperation.html#a40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708">VectorOperation::add</a>);</div><div class="line">  system_rhs.compress(<a class="code" href="structVectorOperation.html#a40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708">VectorOperation::add</a>);</div><div class="line">  timer.<a class="code" href="classTimerOutput.html#a220e755259be51f43eaa547c24b08080">leave_subsection</a>();</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::copy_local_to_global_system(<span class="keyword">const</span> PerTaskData_ASM &amp;data)</div><div class="line">{</div><div class="line">  constraints.<a class="code" href="classConstraintMatrix.html#a1c61203741d499990c6288c3fcf3d48c">distribute_local_to_global</a>(data.cell_matrix, data.cell_rhs,</div><div class="line">                                         data.local_dof_indices,</div><div class="line">                                         tangent_matrix, system_rhs);</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span></div><div class="line">Solid&lt;dim&gt;::assemble_system_one_cell(<span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div><div class="line">                                     ScratchData_ASM &amp;scratch,</div><div class="line">                                     PerTaskData_ASM &amp;data)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cell-&gt;subdomain_id()==this_mpi_process, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line"></div><div class="line">  data.reset();</div><div class="line">  scratch.reset();</div><div class="line">  scratch.fe_values_ref.reinit(cell);</div><div class="line">  cell-&gt;get_dof_indices(data.local_dof_indices);</div><div class="line">  <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const PointHistory&lt;dim&gt; &gt; &gt; lqph =</div><div class="line">    quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div><div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div></div><!-- fragment --><p>Update quadrature point solution</p>
<div class="fragment"><div class="line">scratch.fe_values_ref[u_fe].get_function_gradients(scratch.solution_total,</div><div class="line">                                                   scratch.solution_grads_u_total);</div><div class="line">scratch.fe_values_ref[p_fe].get_function_values(scratch.solution_total,</div><div class="line">                                                scratch.solution_values_p_total);</div><div class="line">scratch.fe_values_ref[J_fe].get_function_values(scratch.solution_total,</div><div class="line">                                                scratch.solution_values_J_total);</div></div><!-- fragment --><p>Update shape functions and their gradients (push-forward)</p>
<div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div><div class="line">    {</div><div class="line">      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> F = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">Physics::Elasticity::Kinematics::F</a>(scratch.solution_grads_u_total[q_point]);</div><div class="line">      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> F_inv = <a class="code" href="classSymmetricTensor.html#a6270f4610919ac288e2bb142588c1b2f">invert</a>(F);</div><div class="line"></div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; dofs_per_cell; ++k)</div><div class="line">        {</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k_group = fe.<a class="code" href="classFiniteElement.html#a95ac75dfc5b9f4e01c34d5865b4ca5a2">system_to_base_index</a>(k).first.first;</div><div class="line">          <span class="keywordflow">if</span> (k_group == u_block)</div><div class="line">            {</div><div class="line">              scratch.grad_Nx[q_point][k] = scratch.fe_values_ref[u_fe].gradient(k, q_point)</div><div class="line">                                            * F_inv;</div><div class="line">              scratch.symm_grad_Nx[q_point][k] = <a class="code" href="classSymmetricTensor.html#a4acdda923e9b04d2d70308f3c095e12f">symmetrize</a>(scratch.grad_Nx[q_point][k]);</div><div class="line">            }</div><div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == p_block)</div><div class="line">            scratch.Nx[q_point][k] = scratch.fe_values_ref[p_fe].value(k,</div><div class="line">                                                                       q_point);</div><div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == J_block)</div><div class="line">            scratch.Nx[q_point][k] = scratch.fe_values_ref[J_fe].value(k,</div><div class="line">                                                                       q_point);</div><div class="line">          <span class="keywordflow">else</span></div><div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(k_group &lt;= J_block, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">        }</div><div class="line">    }</div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div><div class="line">    {</div><div class="line">      <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> &amp;I = <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>;</div><div class="line">      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> F = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">Physics::Elasticity::Kinematics::F</a>(scratch.solution_grads_u_total[q_point]);</div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> det_F = <a class="code" href="classSymmetricTensor.html#a31d48ca1d251a7a32db8b673e6010193">determinant</a>(F);</div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;p_tilde  = scratch.solution_values_p_total[q_point];</div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;J_tilde  = scratch.solution_values_J_total[q_point];</div><div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(det_F &gt; 0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line"></div><div class="line">      {</div><div class="line">        PointHistory&lt;dim&gt; *lqph_q_point_nc =  <span class="keyword">const_cast&lt;</span>PointHistory&lt;dim&gt;*<span class="keyword">&gt;</span>(lqph[q_point].get());</div><div class="line">        lqph_q_point_nc-&gt;update_internal_equilibrium(F,p_tilde,J_tilde);</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau = lqph[q_point]-&gt;get_tau(F,p_tilde);</div><div class="line">      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> tau_ns (tau);</div><div class="line">      <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> Jc = lqph[q_point]-&gt;get_Jc(F,p_tilde);</div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> dPsi_vol_dJ = lqph[q_point]-&gt;get_dPsi_vol_dJ(J_tilde);</div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> d2Psi_vol_dJ2 = lqph[q_point]-&gt;get_d2Psi_vol_dJ2(J_tilde);</div><div class="line"></div><div class="line">      <span class="keyword">const</span> std::vector&lt;double&gt; &amp;Nx = scratch.Nx[q_point];</div><div class="line">      <span class="keyword">const</span> std::vector&lt;Tensor&lt;2, dim&gt; &gt; &amp;grad_Nx = scratch.grad_Nx[q_point];</div><div class="line">      <span class="keyword">const</span> std::vector&lt;SymmetricTensor&lt;2, dim&gt; &gt; &amp;symm_grad_Nx = scratch.symm_grad_Nx[q_point];</div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> JxW = scratch.fe_values_ref.JxW(q_point);</div><div class="line"></div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div><div class="line">        {</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i = fe.<a class="code" href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">system_to_component_index</a>(i).first;</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_group = fe.<a class="code" href="classFiniteElement.html#a95ac75dfc5b9f4e01c34d5865b4ca5a2">system_to_base_index</a>(i).first.first;</div><div class="line">          <span class="keywordflow">if</span> (i_group == u_block)</div><div class="line">            data.cell_rhs(i) -= (symm_grad_Nx[i] * tau) * JxW;</div><div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i_group == p_block)</div><div class="line">            data.cell_rhs(i) -= Nx[i] * (det_F - J_tilde) * JxW;</div><div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i_group == J_block)</div><div class="line">            data.cell_rhs(i) -= Nx[i] * (dPsi_vol_dJ - p_tilde) * JxW;</div><div class="line">          <span class="keywordflow">else</span></div><div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(i_group &lt;= J_block, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line"></div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt;= i; ++j)</div><div class="line">            {</div><div class="line">              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_j = fe.<a class="code" href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">system_to_component_index</a>(j).first;</div><div class="line">              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j_group     = fe.<a class="code" href="classFiniteElement.html#a95ac75dfc5b9f4e01c34d5865b4ca5a2">system_to_base_index</a>(j).first.first;</div><div class="line">              <span class="keywordflow">if</span> ((i_group == u_block) &amp;&amp; (j_group == u_block))</div><div class="line">                {</div><div class="line">                  data.cell_matrix(i, j) += symm_grad_Nx[i] * Jc <span class="comment">// The material contribution:</span></div><div class="line">                                            * symm_grad_Nx[j] * JxW;</div><div class="line">                  <span class="keywordflow">if</span> (component_i == component_j) <span class="comment">// geometrical stress contribution</span></div><div class="line">                    data.cell_matrix(i, j) += grad_Nx[i][component_i] * tau_ns</div><div class="line">                                              * grad_Nx[j][component_j] * JxW;</div><div class="line">                }</div><div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == u_block) &amp;&amp; (j_group == p_block))</div><div class="line">                {</div><div class="line">                  data.cell_matrix(i, j) += (symm_grad_Nx[i] * I)</div><div class="line">                                            * Nx[j] * det_F</div><div class="line">                                            * JxW;</div><div class="line">                }</div><div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == p_block) &amp;&amp; (j_group == u_block))</div><div class="line">                {</div><div class="line">                  data.cell_matrix(i, j) += Nx[i] * det_F</div><div class="line">                                            * (symm_grad_Nx[j] * I)</div><div class="line">                                            * JxW;</div><div class="line">                }</div><div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == p_block) &amp;&amp; (j_group == J_block))</div><div class="line">                data.cell_matrix(i, j) -= Nx[i] * Nx[j] * JxW;</div><div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == J_block) &amp;&amp; (j_group == p_block))</div><div class="line">                data.cell_matrix(i, j) -= Nx[i] * Nx[j] * JxW;</div><div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == J_block) &amp;&amp; (j_group == J_block))</div><div class="line">                data.cell_matrix(i, j) += Nx[i] * d2Psi_vol_dJ2 * Nx[j] * JxW;</div><div class="line">              <span class="keywordflow">else</span></div><div class="line">                <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>((i_group &lt;= J_block) &amp;&amp; (j_group &lt;= J_block),</div><div class="line">                       <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = i + 1; j &lt; dofs_per_cell; ++j)</div><div class="line">      data.cell_matrix(i, j) = data.cell_matrix(j, i);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (parameters.driver == <span class="stringliteral">&quot;Neumann&quot;</span>)</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> face = 0; face &lt; GeometryInfo&lt;dim&gt;::faces_per_cell;</div><div class="line">         ++face)</div><div class="line">      <span class="keywordflow">if</span> (cell-&gt;face(face)-&gt;at_boundary() == <span class="keyword">true</span></div><div class="line">          &amp;&amp; cell-&gt;face(face)-&gt;boundary_id() == parameters.boundary_id_plus_Y)</div><div class="line">        {</div><div class="line">          scratch.fe_face_values_ref.reinit(cell, face);</div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> f_q_point = 0; f_q_point &lt; n_q_points_f;</div><div class="line">               ++f_q_point)</div><div class="line">            {</div><div class="line">              <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;N =</div><div class="line">                scratch.fe_face_values_ref.normal_vector(f_q_point);</div><div class="line">              <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span>  pressure_nom  = parameters.pressure</div><div class="line">                                                   / (parameters.scale * parameters.scale);</div><div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span>         time_ramp = (time.current() &lt; parameters.load_time ?</div><div class="line">                                                time.current() / parameters.load_time : 1.0);</div><div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span>         pressure  = -pressure_nom * time_ramp;</div><div class="line">              <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> traction  = pressure * N;</div><div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div><div class="line">                {</div><div class="line">                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_group =</div><div class="line">                    fe.<a class="code" href="classFiniteElement.html#a95ac75dfc5b9f4e01c34d5865b4ca5a2">system_to_base_index</a>(i).first.first;</div><div class="line">                  <span class="keywordflow">if</span> (i_group == u_block)</div><div class="line">                    {</div><div class="line">                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div><div class="line">                        fe.<a class="code" href="classFiniteElement.html#a86644fe67824373cd51e9ff7fca94f8c">system_to_component_index</a>(i).first;</div><div class="line">                      <span class="keyword">const</span> <span class="keywordtype">double</span> Ni =</div><div class="line">                        scratch.fe_face_values_ref.shape_value(i,</div><div class="line">                                                               f_q_point);</div><div class="line">                      <span class="keyword">const</span> <span class="keywordtype">double</span> JxW = scratch.fe_face_values_ref.JxW(</div><div class="line">                                           f_q_point);</div><div class="line">                      data.cell_rhs(i) += (Ni * traction[component_i])</div><div class="line">                                          * JxW;</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::make_constraints(<span class="keyword">const</span> <span class="keywordtype">int</span> &amp;it_nr)</div><div class="line">{</div><div class="line">  pcout &lt;&lt; <span class="stringliteral">&quot; CST &quot;</span> &lt;&lt; std::flush;</div><div class="line">  <span class="keywordflow">if</span> (it_nr &gt; 1)</div><div class="line">    <span class="keywordflow">return</span>;</div><div class="line">  constraints.<a class="code" href="classConstraintMatrix.html#a24120d0331183f9a63cbe41493a19f6b">clear</a>();</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">bool</span> apply_dirichlet_bc = (it_nr == 0);</div><div class="line">  <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> x_displacement(0);</div><div class="line">  <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> y_displacement(1);</div><div class="line">  {</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> boundary_id = parameters.boundary_id_minus_X;</div><div class="line">    <span class="keywordflow">if</span> (apply_dirichlet_bc == <span class="keyword">true</span>)</div><div class="line">      <a class="code" href="namespaceVectorTools.html#a187aeb575be07bc47cb3dea1a47aaf88">VectorTools::interpolate_boundary_values</a>(dof_handler,</div><div class="line">                                               boundary_id,</div><div class="line">                                               <a class="code" href="classZeroFunction.html">ZeroFunction&lt;dim&gt;</a>(n_components),</div><div class="line">                                               constraints,</div><div class="line">                                               fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement));</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">      <a class="code" href="namespaceVectorTools.html#a187aeb575be07bc47cb3dea1a47aaf88">VectorTools::interpolate_boundary_values</a>(dof_handler,</div><div class="line">                                               boundary_id,</div><div class="line">                                               <a class="code" href="classZeroFunction.html">ZeroFunction&lt;dim&gt;</a>(n_components),</div><div class="line">                                               constraints,</div><div class="line">                                               fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement));</div><div class="line">  }</div><div class="line">  {</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> boundary_id = parameters.boundary_id_minus_Y;</div><div class="line">    <span class="keywordflow">if</span> (apply_dirichlet_bc == <span class="keyword">true</span>)</div><div class="line">      <a class="code" href="namespaceVectorTools.html#a187aeb575be07bc47cb3dea1a47aaf88">VectorTools::interpolate_boundary_values</a>(dof_handler,</div><div class="line">                                               boundary_id,</div><div class="line">                                               <a class="code" href="classZeroFunction.html">ZeroFunction&lt;dim&gt;</a>(n_components),</div><div class="line">                                               constraints,</div><div class="line">                                               fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(y_displacement));</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">      <a class="code" href="namespaceVectorTools.html#a187aeb575be07bc47cb3dea1a47aaf88">VectorTools::interpolate_boundary_values</a>(dof_handler,</div><div class="line">                                               boundary_id,</div><div class="line">                                               <a class="code" href="classZeroFunction.html">ZeroFunction&lt;dim&gt;</a>(n_components),</div><div class="line">                                               constraints,</div><div class="line">                                               fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(y_displacement));</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (dim==3)</div><div class="line">    {</div><div class="line">      <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> z_displacement(2);</div><div class="line">      {</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> boundary_id = parameters.boundary_id_minus_Z;</div><div class="line">        <span class="keywordflow">if</span> (apply_dirichlet_bc == <span class="keyword">true</span>)</div><div class="line">          <a class="code" href="namespaceVectorTools.html#a187aeb575be07bc47cb3dea1a47aaf88">VectorTools::interpolate_boundary_values</a>(dof_handler,</div><div class="line">                                                   boundary_id,</div><div class="line">                                                   <a class="code" href="classZeroFunction.html">ZeroFunction&lt;dim&gt;</a>(n_components),</div><div class="line">                                                   constraints,</div><div class="line">                                                   fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement));</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">          <a class="code" href="namespaceVectorTools.html#a187aeb575be07bc47cb3dea1a47aaf88">VectorTools::interpolate_boundary_values</a>(dof_handler,</div><div class="line">                                                   boundary_id,</div><div class="line">                                                   <a class="code" href="classZeroFunction.html">ZeroFunction&lt;dim&gt;</a>(n_components),</div><div class="line">                                                   constraints,</div><div class="line">                                                   fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement));</div><div class="line">      }</div><div class="line">      {</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> boundary_id = parameters.boundary_id_plus_Z;</div><div class="line">        <span class="keywordflow">if</span> (apply_dirichlet_bc == <span class="keyword">true</span>)</div><div class="line">          <a class="code" href="namespaceVectorTools.html#a187aeb575be07bc47cb3dea1a47aaf88">VectorTools::interpolate_boundary_values</a>(dof_handler,</div><div class="line">                                                   boundary_id,</div><div class="line">                                                   <a class="code" href="classZeroFunction.html">ZeroFunction&lt;dim&gt;</a>(n_components),</div><div class="line">                                                   constraints,</div><div class="line">                                                   fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement));</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">          <a class="code" href="namespaceVectorTools.html#a187aeb575be07bc47cb3dea1a47aaf88">VectorTools::interpolate_boundary_values</a>(dof_handler,</div><div class="line">                                                   boundary_id,</div><div class="line">                                                   <a class="code" href="classZeroFunction.html">ZeroFunction&lt;dim&gt;</a>(n_components),</div><div class="line">                                                   constraints,</div><div class="line">                                                   fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement));</div><div class="line">      }</div><div class="line">    }</div><div class="line">  <span class="keywordflow">if</span> (parameters.driver == <span class="stringliteral">&quot;Dirichlet&quot;</span>)</div><div class="line">    {</div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">int</span> boundary_id = parameters.boundary_id_plus_Y;</div><div class="line">      <span class="keywordflow">if</span> (apply_dirichlet_bc == <span class="keyword">true</span>)</div><div class="line">        {</div><div class="line"></div><div class="line">          <span class="keywordflow">if</span> (time.current() &lt; parameters.load_time+0.01*time.get_delta_t())</div><div class="line">            {</div><div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span> delta_length = parameters.length*(parameters.stretch - 1.0)*parameters.scale;</div><div class="line">              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_stretch_steps = parameters.load_time/time.get_delta_t();</div><div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span> delta_u_y = delta_length/2.0/n_stretch_steps;</div><div class="line">              <a class="code" href="namespaceVectorTools.html#a187aeb575be07bc47cb3dea1a47aaf88">VectorTools::interpolate_boundary_values</a>(dof_handler,</div><div class="line">                                                       boundary_id,</div><div class="line">                                                       <a class="code" href="classConstantFunction.html">ConstantFunction&lt;dim&gt;</a>(delta_u_y,n_components),</div><div class="line">                                                       constraints,</div><div class="line">                                                       fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(y_displacement));</div><div class="line">            }</div><div class="line">          <span class="keywordflow">else</span></div><div class="line">            <a class="code" href="namespaceVectorTools.html#a187aeb575be07bc47cb3dea1a47aaf88">VectorTools::interpolate_boundary_values</a>(dof_handler,</div><div class="line">                                                     boundary_id,</div><div class="line">                                                     <a class="code" href="classZeroFunction.html">ZeroFunction&lt;dim&gt;</a>(n_components),</div><div class="line">                                                     constraints,</div><div class="line">                                                     fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(y_displacement));</div><div class="line">        }</div><div class="line">      <span class="keywordflow">else</span></div><div class="line">        <a class="code" href="namespaceVectorTools.html#a187aeb575be07bc47cb3dea1a47aaf88">VectorTools::interpolate_boundary_values</a>(dof_handler,</div><div class="line">                                                 boundary_id,</div><div class="line">                                                 <a class="code" href="classZeroFunction.html">ZeroFunction&lt;dim&gt;</a>(n_components),</div><div class="line">                                                 constraints,</div><div class="line">                                                 fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(y_displacement));</div><div class="line">    }</div><div class="line">  constraints.<a class="code" href="classConstraintMatrix.html#a8056d07faa2a7ed3f158c1b42d56abc8">close</a>();</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line">std::pair&lt;unsigned int, double&gt;</div><div class="line">Solid&lt;dim&gt;::solve_linear_system(LA::MPI::BlockVector &amp;newton_update)</div><div class="line">{</div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lin_it = 0;</div><div class="line">  <span class="keywordtype">double</span> lin_res = 0.0;</div><div class="line"></div><div class="line">  timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div><div class="line">  pcout &lt;&lt; <span class="stringliteral">&quot; SLV &quot;</span> &lt;&lt; std::flush;</div><div class="line"></div><div class="line">  <span class="keyword">const</span> LA::MPI::Vector &amp;f_u = system_rhs.block(u_block);</div><div class="line">  <span class="keyword">const</span> LA::MPI::Vector &amp;f_p = system_rhs.block(p_block);</div><div class="line">  <span class="keyword">const</span> LA::MPI::Vector &amp;f_J = system_rhs.block(J_block);</div><div class="line">  LA::MPI::Vector &amp;d_u = newton_update.block(u_block);</div><div class="line">  LA::MPI::Vector &amp;d_p = newton_update.block(p_block);</div><div class="line">  LA::MPI::Vector &amp;d_J = newton_update.block(J_block);</div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> K_uu = linear_operator&lt;LA::MPI::Vector&gt;(tangent_matrix.block(u_block, u_block));</div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> K_up = linear_operator&lt;LA::MPI::Vector&gt;(tangent_matrix.block(u_block, p_block));</div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> K_pu = linear_operator&lt;LA::MPI::Vector&gt;(tangent_matrix.block(p_block, u_block));</div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> K_Jp = linear_operator&lt;LA::MPI::Vector&gt;(tangent_matrix.block(J_block, p_block));</div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> K_JJ = linear_operator&lt;LA::MPI::Vector&gt;(tangent_matrix.block(J_block, J_block));</div><div class="line"></div><div class="line">  LA::PreconditionJacobi preconditioner_K_Jp_inv;</div><div class="line">  preconditioner_K_Jp_inv.initialize(</div><div class="line">    tangent_matrix.block(J_block, p_block),</div><div class="line">    LA::PreconditionJacobi::AdditionalData());</div><div class="line">  <a class="code" href="classReductionControl.html">ReductionControl</a> solver_control_K_Jp_inv (</div><div class="line">    tangent_matrix.block(J_block, p_block).m() * parameters.max_iterations_lin,</div><div class="line">    1.0e-30, 1e-6);</div><div class="line">  <a class="code" href="classSolverCG.html">::SolverCG&lt;LA::MPI::Vector&gt;</a> solver_K_Jp_inv (solver_control_K_Jp_inv);</div><div class="line"></div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> K_Jp_inv = <a class="code" href="group__LAOperators.html#ga87e38fbde431397c069a88692bd24ae7">inverse_operator</a>(K_Jp,</div><div class="line">                                         solver_K_Jp_inv,</div><div class="line">                                         preconditioner_K_Jp_inv);</div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> K_pJ_inv     = <a class="code" href="group__LAOperators.html#ga6bdc65fb2db56230e6bc7d545e81295d">transpose_operator</a>(K_Jp_inv);</div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> K_pp_bar     = K_Jp_inv * K_JJ * K_pJ_inv;</div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> K_uu_bar_bar = K_up * K_pp_bar * K_pu;</div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> K_uu_con     = K_uu + K_uu_bar_bar;</div><div class="line"></div><div class="line">  LA::PreconditionAMG preconditioner_K_con_inv;</div><div class="line">  preconditioner_K_con_inv.initialize(</div><div class="line">    tangent_matrix.block(u_block, u_block),</div><div class="line">    LA::PreconditionAMG::AdditionalData(</div><div class="line">      <span class="keyword">true</span> / *elliptic* /,</div><div class="line">      (parameters.poly_degree &gt; 1 / *higher_order_elements* /)) );</div><div class="line">  <a class="code" href="classReductionControl.html">ReductionControl</a> solver_control_K_con_inv (</div><div class="line">    tangent_matrix.block(u_block, u_block).m() * parameters.max_iterations_lin,</div><div class="line">    1.0e-30, parameters.tol_lin);</div><div class="line">  <a class="code" href="classSolverSelector.html">::SolverSelector&lt;LA::MPI::Vector&gt;</a> solver_K_con_inv;</div><div class="line">  solver_K_con_inv.<a class="code" href="classSolverSelector.html#a3da215c843356cdab3b603ce98991b53">select</a>(parameters.type_lin);</div><div class="line">  solver_K_con_inv.set_control(solver_control_K_con_inv);</div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> K_uu_con_inv = <a class="code" href="group__LAOperators.html#ga87e38fbde431397c069a88692bd24ae7">inverse_operator</a>(K_uu_con,</div><div class="line">                                             solver_K_con_inv,</div><div class="line">                                             preconditioner_K_con_inv);</div><div class="line"></div><div class="line">  d_u     = K_uu_con_inv*(f_u - K_up*(K_Jp_inv*f_J - K_pp_bar*f_p));</div><div class="line">  lin_it  = solver_control_K_con_inv.last_step();</div><div class="line">  lin_res = solver_control_K_con_inv.last_value();</div><div class="line">  timer.<a class="code" href="classTimerOutput.html#a220e755259be51f43eaa547c24b08080">leave_subsection</a>();</div><div class="line"></div><div class="line">  timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver postprocessing&quot;</span>);</div><div class="line">  d_J = K_pJ_inv*(f_p - K_pu*d_u);</div><div class="line">  d_p = K_Jp_inv*(f_J - K_JJ*d_J);</div><div class="line">  timer.<a class="code" href="classTimerOutput.html#a220e755259be51f43eaa547c24b08080">leave_subsection</a>();</div><div class="line"></div><div class="line">  constraints.<a class="code" href="classConstraintMatrix.html#a5bd4b10531ae0809a415d91742d1870c">distribute</a>(newton_update);</div><div class="line">  <span class="keywordflow">return</span> std::make_pair(lin_it, lin_res);</div><div class="line">}</div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span></div><div class="line">Solid&lt;dim&gt;::update_end_timestep ()</div><div class="line">{</div><div class="line">  <a class="code" href="classFilteredIterator.html">FilteredIterator&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator</a>&gt;</div><div class="line">  cell (<a class="code" href="classIteratorFilters_1_1SubdomainEqualTo.html">IteratorFilters::SubdomainEqualTo</a>(this_mpi_process),</div><div class="line">        dof_handler.<a class="code" href="classDoFHandler.html#a1a36dbbb4c54a7038c60ee9c8eab369a">begin_active</a>()),</div><div class="line">                                 endc (<a class="code" href="classIteratorFilters_1_1SubdomainEqualTo.html">IteratorFilters::SubdomainEqualTo</a>(this_mpi_process),</div><div class="line">                                       dof_handler.<a class="code" href="classDoFHandler.html#a7b510a66ee9ea25720f64220496126ec">end</a>());</div><div class="line">  <span class="keywordflow">for</span> (; cell != endc; ++cell)</div><div class="line">    {</div><div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cell-&gt;subdomain_id()==this_mpi_process, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">      <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;PointHistory&lt;dim&gt; &gt; &gt; lqph =</div><div class="line">        quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div><div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div><div class="line">        lqph[q_point]-&gt;update_end_timestep();</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keywordtype">int</span> dim, <span class="keyword">class</span> DH=DoFHandler&lt;dim&gt; &gt;</div><div class="line"><span class="keyword">class </span>FilteredDataOut : <span class="keyword">public</span> <a class="code" href="classDataOut.html">DataOut</a>&lt;dim, DH&gt;</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  FilteredDataOut (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> subdomain_id)</div><div class="line">    :</div><div class="line">    subdomain_id (subdomain_id)</div><div class="line">  {}</div><div class="line"></div><div class="line">  <span class="keyword">virtual</span> ~FilteredDataOut() {}</div><div class="line"></div><div class="line">  <span class="keyword">virtual</span> <span class="keyword">typename</span> <a class="code" href="classTriaIterator.html">DataOut&lt;dim, DH&gt;::cell_iterator</a></div><div class="line">  <a class="code" href="classDataOut.html#a1af7d4c3409e24acbcc4f8a1da4723e5">first_cell</a> ()</div><div class="line">  {</div><div class="line">    <span class="keyword">typename</span> <a class="code" href="classTriaActiveIterator.html">DataOut&lt;dim, DH&gt;::active_cell_iterator</a></div><div class="line">    cell = this-&gt;dofs-&gt;<a class="code" href="classDoFHandler.html#a1a36dbbb4c54a7038c60ee9c8eab369a">begin_active</a>();</div><div class="line">    <span class="keywordflow">while</span> ((cell != this-&gt;dofs-&gt;end()) &amp;&amp;</div><div class="line">           (cell-&gt;subdomain_id() != <a class="code" href="namespacetypes.html#a34b501118128294d2bc316a1b052454f">subdomain_id</a>))</div><div class="line">      ++cell;</div><div class="line">    <span class="keywordflow">return</span> cell;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keyword">virtual</span> <span class="keyword">typename</span> <a class="code" href="classTriaIterator.html">DataOut&lt;dim, DH&gt;::cell_iterator</a></div><div class="line">  <a class="code" href="classDataOut.html#afdefbb966f2053f4c4fc52293d2339ce">next_cell</a> (<span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classTriaIterator.html">DataOut&lt;dim, DH&gt;::cell_iterator</a> &amp;old_cell)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (old_cell != this-&gt;dofs-&gt;end())</div><div class="line">      {</div><div class="line">        <span class="keyword">const</span> <a class="code" href="classIteratorFilters_1_1SubdomainEqualTo.html">IteratorFilters::SubdomainEqualTo</a> predicate(subdomain_id);</div><div class="line">        <span class="keywordflow">return</span></div><div class="line">          ++(<a class="code" href="classFilteredIterator.html">FilteredIterator</a></div><div class="line">             &lt;<span class="keyword">typename</span> <a class="code" href="classTriaActiveIterator.html">DataOut&lt;dim, DH&gt;::active_cell_iterator</a>&gt;</div><div class="line">             (predicate,old_cell));</div><div class="line">      }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">      <span class="keywordflow">return</span> old_cell;</div><div class="line">  }</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#a34b501118128294d2bc316a1b052454f">subdomain_id</a>;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timestep,</div><div class="line">                                <span class="keyword">const</span> <span class="keywordtype">double</span>       current_time)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div></div><!-- fragment --><p>Output -&gt; Ghosted vector</p>
<div class="fragment"><div class="line">LA::MPI::BlockVector solution_total (locally_owned_partitioning,</div><div class="line">                                     locally_relevant_partitioning,</div><div class="line">                                     mpi_communicator,</div><div class="line">                                     / *vector_writable = * / <span class="keyword">false</span>);</div><div class="line">LA::MPI::BlockVector residual (locally_owned_partitioning,</div><div class="line">                               locally_relevant_partitioning,</div><div class="line">                               mpi_communicator,</div><div class="line">                               / *vector_writable = * / <span class="keyword">false</span>);</div><div class="line">solution_total = solution_n;</div><div class="line">residual = system_rhs;</div><div class="line">residual *= -1.0;</div></div><!-- fragment --><p>&mdash; Additional data &mdash;</p>
<div class="fragment"><div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> material_id;</div><div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> polynomial_order;</div><div class="line">material_id.<a class="code" href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(triangulation.<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>());</div><div class="line">polynomial_order.<a class="code" href="classVector.html#ac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(triangulation.<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>());</div><div class="line">std::vector&lt;types::subdomain_id&gt; partition_int (triangulation.<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>());</div><div class="line"></div><div class="line">FilteredDataOut&lt;dim&gt; data_out(this_mpi_process);</div><div class="line">std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div><div class="line">data_component_interpretation(dim,</div><div class="line">                              <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>);</div><div class="line">data_component_interpretation.push_back(<a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div><div class="line">data_component_interpretation.push_back(<a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div><div class="line"></div><div class="line"><a class="code" href="namespaceGridTools.html#ae0cb61bdd7e17c6b1589bdd16891e561">GridTools::get_subdomain_association</a> (triangulation, partition_int);</div></div><!-- fragment --><p>Can't use filtered iterators here because the cell count "c" is incorrect for the parallel case</p>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0;</div><div class="line"><span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::active_cell_iterator</a></div><div class="line">cell = dof_handler.<a class="code" href="classDoFHandler.html#a1a36dbbb4c54a7038c60ee9c8eab369a">begin_active</a>(),</div><div class="line">endc = dof_handler.<a class="code" href="classDoFHandler.html#a7b510a66ee9ea25720f64220496126ec">end</a>();</div><div class="line"><span class="keywordflow">for</span> (; cell!=endc; ++cell, ++c)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (cell-&gt;subdomain_id() != this_mpi_process) <span class="keywordflow">continue</span>;</div><div class="line"></div><div class="line">    material_id(c) = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(cell-&gt;material_id());</div><div class="line">  }</div><div class="line"></div><div class="line">std::vector&lt;std::string&gt; solution_name(n_components, <span class="stringliteral">&quot;solution_&quot;</span>);</div><div class="line">std::vector&lt;std::string&gt; residual_name(n_components, <span class="stringliteral">&quot;residual_&quot;</span>);</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c=0; c&lt;<a class="code" href="classDoFHandler.html#ac69f2dc12d3d013e11f7bfd70e328dcb">n_components</a>; ++c)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (block_component[c] == u_block)</div><div class="line">      {</div><div class="line">        solution_name[c] += <span class="stringliteral">&quot;u&quot;</span>;</div><div class="line">        residual_name[c] += <span class="stringliteral">&quot;u&quot;</span>;</div><div class="line">      }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (block_component[c] == p_block)</div><div class="line">      {</div><div class="line">        solution_name[c] += <span class="stringliteral">&quot;p&quot;</span>;</div><div class="line">        residual_name[c] += <span class="stringliteral">&quot;p&quot;</span>;</div><div class="line">      }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (block_component[c] == J_block)</div><div class="line">      {</div><div class="line">        solution_name[c] += <span class="stringliteral">&quot;J&quot;</span>;</div><div class="line">        residual_name[c] += <span class="stringliteral">&quot;J&quot;</span>;</div><div class="line">      }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">      {</div><div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(c &lt;= J_block, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">      }</div><div class="line">  }</div><div class="line"></div><div class="line">data_out.<a class="code" href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">attach_dof_handler</a>(dof_handler);</div><div class="line">data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(solution_total,</div><div class="line">                         solution_name,</div><div class="line">                         <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>,</div><div class="line">                         data_component_interpretation);</div><div class="line">data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(residual,</div><div class="line">                         residual_name,</div><div class="line">                         <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>,</div><div class="line">                         data_component_interpretation);</div><div class="line"><span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> partitioning(partition_int.begin(),</div><div class="line">                                  partition_int.end());</div><div class="line">data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a> (material_id, <span class="stringliteral">&quot;material_id&quot;</span>);</div><div class="line">data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a> (partitioning, <span class="stringliteral">&quot;partitioning&quot;</span>);</div><div class="line">data_out.<a class="code" href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">build_patches</a>(degree);</div><div class="line"></div><div class="line"><span class="keyword">struct </span>Filename</div><div class="line">{</div><div class="line">  <span class="keyword">static</span> std::string get_filename_vtu (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> process,</div><div class="line">                                       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timestep,</div><div class="line">                                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_digits = 4)</div><div class="line">  {</div><div class="line">    std::ostringstream filename_vtu;</div><div class="line">    filename_vtu</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;solution-&quot;</span></div><div class="line">        &lt;&lt; (std::to_string(dim) + <span class="stringliteral">&quot;d&quot;</span>)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;.&quot;</span></div><div class="line">        &lt;&lt; <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a> (process, n_digits)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;.&quot;</span></div><div class="line">        &lt;&lt; <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(timestep, n_digits)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;.vtu&quot;</span>;</div><div class="line">    <span class="keywordflow">return</span> filename_vtu.str();</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keyword">static</span> std::string get_filename_pvtu (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timestep,</div><div class="line">                                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_digits = 4)</div><div class="line">  {</div><div class="line">    std::ostringstream filename_vtu;</div><div class="line">    filename_vtu</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;solution-&quot;</span></div><div class="line">        &lt;&lt; (std::to_string(dim) + <span class="stringliteral">&quot;d&quot;</span>)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;.&quot;</span></div><div class="line">        &lt;&lt; <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(timestep, n_digits)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;.pvtu&quot;</span>;</div><div class="line">    <span class="keywordflow">return</span> filename_vtu.str();</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keyword">static</span> std::string get_filename_pvd (<span class="keywordtype">void</span>)</div><div class="line">  {</div><div class="line">    std::ostringstream filename_vtu;</div><div class="line">    filename_vtu</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;solution-&quot;</span></div><div class="line">        &lt;&lt; (std::to_string(dim) + <span class="stringliteral">&quot;d&quot;</span>)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;.pvd&quot;</span>;</div><div class="line">    <span class="keywordflow">return</span> filename_vtu.str();</div><div class="line">  }</div><div class="line">};</div></div><!-- fragment --><p>Write out main data file</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> std::string filename_vtu = Filename::get_filename_vtu(this_mpi_process, timestep);</div><div class="line">std::ofstream output(filename_vtu.c_str());</div><div class="line">data_out.<a class="code" href="classDataOutInterface.html#a93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(output);</div></div><!-- fragment --><p>Collection of files written in parallel This next set of steps should only be performed by master process</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (this_mpi_process == 0)</div><div class="line">  {</div></div><!-- fragment --><p>List of all files written out at this timestep by all processors</p>
<div class="fragment"><div class="line">std::vector&lt;std::string&gt; parallel_filenames_vtu;</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p=0; p &lt; n_mpi_processes; ++p)</div><div class="line">  {</div><div class="line">    parallel_filenames_vtu.push_back(Filename::get_filename_vtu(p, timestep));</div><div class="line">  }</div><div class="line"></div><div class="line"><span class="keyword">const</span> std::string filename_pvtu (Filename::get_filename_pvtu(timestep));</div><div class="line">std::ofstream pvtu_master(filename_pvtu.c_str());</div><div class="line">data_out.<a class="code" href="classDataOutInterface.html#a1eff778443cd0431cd807c45b6ae16d9">write_pvtu_record</a>(pvtu_master,</div><div class="line">                           parallel_filenames_vtu);</div></div><!-- fragment --><p>Time dependent data master file</p>
<div class="fragment"><div class="line">        <span class="keyword">static</span> std::vector&lt;std::pair&lt;double,std::string&gt; &gt; time_and_name_history;</div><div class="line">        time_and_name_history.push_back (std::make_pair (current_time,</div><div class="line">                                                         filename_pvtu));</div><div class="line">        <span class="keyword">const</span> std::string filename_pvd (Filename::get_filename_pvd());</div><div class="line">        std::ofstream pvd_output (filename_pvd.c_str());</div><div class="line">        <a class="code" href="namespaceDataOutBase.html#a9bcaee76160be3f2cee5c15ca7976a26">DataOutBase::write_pvd_record</a> (pvd_output, time_and_name_history);</div><div class="line">      }</div><div class="line">  }</div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::compute_vertex_positions(std::vector&lt;double&gt; &amp;real_time,</div><div class="line">                                            std::vector&lt;std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &gt; &gt; &amp;tracked_vertices,</div><div class="line">                                            <span class="keyword">const</span> LA::MPI::BlockVector &amp;solution_total)<span class="keyword"> const</span></div><div class="line"><span class="keyword">  </span>{</div><div class="line">    real_time.push_back(time.current());</div><div class="line"></div><div class="line">    std::vector&lt;bool&gt; vertex_found (tracked_vertices.size(), <span class="keyword">false</span>);</div><div class="line">    std::vector&lt;Tensor&lt;1,dim&gt; &gt; vertex_update (tracked_vertices.size());</div><div class="line"></div><div class="line">    <a class="code" href="classFilteredIterator.html">FilteredIterator&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator</a>&gt;</div><div class="line">    cell (<a class="code" href="classIteratorFilters_1_1SubdomainEqualTo.html">IteratorFilters::SubdomainEqualTo</a>(this_mpi_process),</div><div class="line">          dof_handler.<a class="code" href="classDoFHandler.html#a1a36dbbb4c54a7038c60ee9c8eab369a">begin_active</a>()),</div><div class="line">                                   endc (<a class="code" href="classIteratorFilters_1_1SubdomainEqualTo.html">IteratorFilters::SubdomainEqualTo</a>(this_mpi_process),</div><div class="line">                                         dof_handler.<a class="code" href="classDoFHandler.html#a7b510a66ee9ea25720f64220496126ec">end</a>());</div><div class="line">    <span class="keywordflow">for</span> (; cell != endc; ++cell)</div><div class="line">      {</div><div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(cell-&gt;subdomain_id()==this_mpi_process, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v=0; v&lt;GeometryInfo&lt;dim&gt;::vertices_per_cell; ++v)</div><div class="line">          {</div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p=0; p&lt;tracked_vertices.size(); ++p)</div><div class="line">              {</div><div class="line">                <span class="keywordflow">if</span> (vertex_found[p] == <span class="keyword">true</span>) <span class="keywordflow">continue</span>;</div><div class="line"></div><div class="line">                <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> pt_ref = tracked_vertices[p][0];</div><div class="line">                <span class="keywordflow">if</span> (cell-&gt;vertex(v).distance(pt_ref) &lt; 1e-6*parameters.scale)</div><div class="line">                  {</div><div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d=0; d&lt;dim; ++d)</div><div class="line">                      vertex_update[p][d] = solution_total(cell-&gt;vertex_dof_index(v,u_block+d));</div><div class="line"></div><div class="line">                    vertex_found[p] = <span class="keyword">true</span>;</div><div class="line">                  }</div><div class="line">              }</div><div class="line">          }</div><div class="line">      }</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p=0; p&lt;tracked_vertices.size(); ++p)</div><div class="line">      {</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> found_on_n_processes = <a class="code" href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">Utilities::MPI::sum</a>(<span class="keywordtype">int</span>(vertex_found[p]), mpi_communicator);</div><div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(found_on_n_processes&gt;0, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Vertex not found on any processor&quot;</span>));</div><div class="line">        <a class="code" href="classTensor.html">Tensor&lt;1,dim&gt;</a> update;</div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d=0; d&lt;dim; ++d)</div><div class="line">          update[d] = <a class="code" href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">Utilities::MPI::sum</a>(vertex_update[p][d], mpi_communicator);</div><div class="line">        update /= found_on_n_processes;</div><div class="line">        tracked_vertices[p].push_back(tracked_vertices[p][0] + update);</div><div class="line">      }</div><div class="line"></div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div><div class="line">  <span class="keyword">using namespace </span>ViscoElasStripHole;</div><div class="line"></div><div class="line">  <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_initialization(argc, argv);</div><div class="line"></div><div class="line">  <span class="keywordflow">try</span></div><div class="line">    {</div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dim = 2; <span class="comment">// Works in both 2d and 3d</span></div><div class="line">      Solid&lt;dim&gt; solid(<span class="stringliteral">&quot;parameters.prm&quot;</span>);</div><div class="line">      solid.run();</div><div class="line">    }</div><div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> (<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">Utilities::MPI::this_mpi_process</a>(MPI_COMM_WORLD) == 0)</div><div class="line">        {</div><div class="line">          std::cerr &lt;&lt; std::endl &lt;&lt; std::endl</div><div class="line">                    &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div><div class="line">                    &lt;&lt; std::endl;</div><div class="line">          std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl &lt;&lt; exc.what()</div><div class="line">                    &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div><div class="line">                    &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div><div class="line">                    &lt;&lt; std::endl;</div><div class="line">          <span class="keywordflow">return</span> 1;</div><div class="line">        }</div><div class="line">    }</div><div class="line">  <span class="keywordflow">catch</span> (...)</div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> (<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">Utilities::MPI::this_mpi_process</a>(MPI_COMM_WORLD) == 0)</div><div class="line">        {</div><div class="line">          std::cerr &lt;&lt; std::endl &lt;&lt; std::endl</div><div class="line">                    &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div><div class="line">                    &lt;&lt; std::endl;</div><div class="line">          std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span></div><div class="line">                    &lt;&lt; std::endl</div><div class="line">                    &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div><div class="line">                    &lt;&lt; std::endl;</div><div class="line">          <span class="keywordflow">return</span> 1;</div><div class="line">        }</div><div class="line">    }</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
