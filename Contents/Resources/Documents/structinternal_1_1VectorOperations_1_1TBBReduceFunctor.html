<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: internal::VectorOperations::TBBReduceFunctor&lt; Operation, ResultType &gt; Struct Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2017 by the deal.II authors"></meta>
<meta name="deal.II-version" content="9.0.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 9.0.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceinternal.html">internal</a></li><li class="navelem"><b>VectorOperations</b></li><li class="navelem"><a class="el" href="structinternal_1_1VectorOperations_1_1TBBReduceFunctor.html">TBBReduceFunctor</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="structinternal_1_1VectorOperations_1_1TBBReduceFunctor-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">internal::VectorOperations::TBBReduceFunctor&lt; Operation, ResultType &gt; Struct Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="vector__operations__internal_8h_source.html">deal.II/lac/vector_operations_internal.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a9e5a83dddb50865617eaefee22460173"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structinternal_1_1VectorOperations_1_1TBBReduceFunctor.html#a9e5a83dddb50865617eaefee22460173">operator()</a> (const tbb::blocked_range&lt; size_type &gt; &amp;range) const</td></tr>
<tr class="separator:a9e5a83dddb50865617eaefee22460173"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;typename Operation, typename ResultType&gt;<br />
struct internal::VectorOperations::TBBReduceFunctor&lt; Operation, ResultType &gt;</h3>

<p>This struct takes the loop range from the tbb parallel for loop and translates it to the actual ranges of the reduction loop inside the vector. It encodes the grain size but might choose larger values of chunks than the minimum grain size. The minimum grain size given to tbb is 1. For affinity reasons, the layout in this loop must be kept in sync with the respective class for plain for loops further up.</p>
<p>Due to this construction, TBB usually only sees a loop of length 4*num_threads with grain size 1. The actual ranges inside the vector are computed outside of TBB because otherwise TBB would split the ranges in some unpredictable position which destroys exact bitwise reproducibility. An important part of this is that inside TBBReduceFunctor::operator() the recursive calls to accumulate are done sequentially on one item a time (even though we could directly run it on the whole range given through the tbb::blocked_range times the chunk size</p><ul>
<li>but that would be unpredictable). Thus, the values we cannot control are the positions in the array that gets filled - but up to that point the algorithm TBB sees is just a parallel for and nothing unpredictable can happen.</li>
</ul>
<p>To sum up: Once the number of threads and the vector size are fixed, we have an exact layout of how the calls into the recursive function will happen. Inside the recursive function, we again only depend on the length. Finally, the concurrent threads write into different positions in a result vector in a thread-safe way and the addition in the short array is again serial. </p>

<p class="definition">Definition at line <a class="el" href="vector__operations__internal_8h_source.html#l01169">1169</a> of file <a class="el" href="vector__operations__internal_8h_source.html">vector_operations_internal.h</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a9e5a83dddb50865617eaefee22460173"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e5a83dddb50865617eaefee22460173">&#9670;&nbsp;</a></span>operator()()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Operation, typename ResultType&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="structinternal_1_1VectorOperations_1_1TBBReduceFunctor.html">internal::VectorOperations::TBBReduceFunctor</a>&lt; Operation, ResultType &gt;::operator() </td>
          <td>(</td>
          <td class="paramtype">const tbb::blocked_range&lt; size_type &gt; &amp;&#160;</td>
          <td class="paramname"><em>range</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>An operator used by TBB to work on a given <code>range</code> of chunks [range.begin(), range.end()). </p>

<p class="definition">Definition at line <a class="el" href="vector__operations__internal_8h_source.html#l01213">1213</a> of file <a class="el" href="vector__operations__internal_8h_source.html">vector_operations_internal.h</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>deal.II/lac/<a class="el" href="vector__operations__internal_8h_source.html">vector_operations_internal.h</a></li>
</ul>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
